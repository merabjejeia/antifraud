<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Инструменты для антифрода</title>
    <!-- Favicon - милая кошечка -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='catGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%23ff6b9d;stop-opacity:1' /><stop offset='100%' style='stop-color:%23c44569;stop-opacity:1' /></linearGradient></defs><circle cx='50' cy='50' r='45' fill='url(%23catGrad)' stroke='%23fff' stroke-width='2'/><circle cx='40' cy='40' r='6' fill='%23fff'/><circle cx='60' cy='40' r='6' fill='%23fff'/><circle cx='40' cy='40' r='3' fill='%23333'/><circle cx='60' cy='40' r='3' fill='%23333'/><path d='M 35 55 Q 50 65 65 55' stroke='%23fff' stroke-width='3' fill='none' stroke-linecap='round'/><path d='M 30 25 Q 35 20 40 25' stroke='%23fff' stroke-width='2' fill='none'/><path d='M 60 25 Q 65 20 70 25' stroke='%23fff' stroke-width='2' fill='none'/></svg>">
    
    
    <!-- Подключение Tailwind CSS из CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Устанавливаем шрифт Inter */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Позиционирование canvas для фона */
        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 flex items-center justify-center min-h-screen p-4 transition-colors duration-500">
    <!-- Анимированный фон Canvas -->
    <canvas id="background-canvas"></canvas>

    <!-- Основной контейнер-карточка -->
    <div class="bg-white dark:bg-slate-900 p-8 rounded-2xl shadow-xl dark:shadow-2xl dark:shadow-black/50 w-full max-w-2xl relative z-10 transition-colors duration-500">
        
        <!-- Главная страница (по умолчанию видимая) -->
        <div id="home-page" class="space-y-6">
            <h1 class="text-3xl font-bold text-center text-slate-800 dark:text-slate-100 mb-6 transition-colors duration-500">
                Инструменты для антифрода
            </h1>
            <p class="text-lg text-slate-600 dark:text-slate-400 text-center mb-8 transition-colors duration-500">
                Добро пожаловать. Выберите необходимый инструмент ниже.
            </p>
            <div class="flex flex-col space-y-4">
                <a 
                    id="go-to-generator-btn" 
                    href="#generator"
                    target="_blank" rel="noopener noreferrer"
                    class="w-full text-center bg-teal-500 dark:bg-teal-600 text-white font-medium text-lg py-4 px-8 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                >
                    Длинный ID вывода
                </a>
                <a 
                    id="go-to-user-generator-btn" 
                    href="#user-generator"
                    target="_blank" rel="noopener noreferrer"
                    class="w-full text-center bg-teal-500 dark:bg-teal-600 text-white font-medium text-lg py-4 px-8 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                >
                    ID пользователя
                </a>
                <a 
                    id="go-to-crypto-generator-btn" 
                    href="#crypto-generator"
                    target="_blank" rel="noopener noreferrer"
                    class="w-full text-center bg-teal-500 dark:bg-teal-600 text-white font-medium text-lg py-4 px-8 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                >
                    Обозреватель кошельков
                </a>
                <a 
                    id="go-to-pairs-generator-btn"
                    href="#pairs-generator"
                    target="_blank" rel="noopener noreferrer"
                    class="w-full text-center bg-teal-500 dark:bg-teal-600 text-white font-medium text-lg py-4 px-8 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                >
                    Пары кошельков → ссылки проверки
                </a>
                <a 
                    id="go-to-user-data-btn"
                    href="#user-data"
                    target="_blank" rel="noopener noreferrer"
                    class="w-full text-center bg-teal-500 dark:bg-teal-600 text-white font-medium text-lg py-4 px-8 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                >
                    Анализ логов пользователей
                </a>
                
            </div>
        </div>

        <!-- Раздел "Длинный ID вывода" (изначально скрытый) -->
        <div id="generator-page" class="hidden">
            <h1 class="text-3xl font-bold text-center text-slate-800 dark:text-slate-100 mb-6 transition-colors duration-500">
                Инструменты для антифрода
            </h1>
            <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 transition-colors duration-500">
                <h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4 transition-colors duration-500">
                    Длинный ID вывода
                </h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-4 transition-colors duration-500">
                    Вставьте один или несколько номеров инвойсов, каждый с новой строки.
                </p>

                <textarea 
                    id="invoice-input" 
                    class="w-full h-32 p-3 text-sm rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 mb-4 transition-colors" 
                    placeholder="Например:
1757862788425449503
1757862788425449504
1757862788425449505"
                ></textarea>
                
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button 
                        id="generate-btn" 
                        class="w-full bg-teal-500 dark:bg-teal-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                    >
                        Сгенерировать ссылки
                    </button>
                    <button 
                        id="open-all-btn" 
                        class="w-full bg-slate-300 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-medium py-3 px-6 rounded-lg hover:bg-slate-400 dark:hover:bg-slate-600 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 focus:ring-offset-2 hidden"
                    >
                        Открыть все
                    </button>
                </div>
                
                <div id="links-output" class="mt-6 flex flex-col space-y-2">
                    <!-- Сюда будут добавляться сгенерированные ссылки -->
                </div>
            </div>
             <button 
                id="back-from-generator-btn" 
                class="mt-6 w-full text-teal-600 dark:text-teal-400 font-medium py-3 px-6 rounded-lg hover:underline transition-all focus:outline-none"
            >
                ← Вернуться назад
            </button>
        </div>
        <!-- Новый раздел "Открытие пользователей" (изначально скрытый) -->
        <div id="user-generator-page" class="hidden">
            <h1 class="text-3xl font-bold text-center text-slate-800 dark:text-slate-100 mb-6 transition-colors duration-500">
                Инструменты для антифрода
            </h1>
            <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 transition-colors duration-500">
                <h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4 transition-colors duration-500">
                    Открыть пользователей по ID
                </h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-4 transition-colors duration-500">
                    Вставьте один или несколько ID пользователей, каждый с новой строки.
                </p>

                <textarea 
                    id="user-input" 
                    class="w-full h-32 p-3 text-sm rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 mb-4 transition-colors" 
                    placeholder="Например:
23440844
23440845
23440846"
                ></textarea>
                
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button 
                        id="user-generate-btn" 
                        class="w-full bg-teal-500 dark:bg-teal-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                    >
                        Сгенерировать ссылки
                    </button>
                    <button 
                        id="user-open-all-btn" 
                        class="w-full bg-slate-300 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-medium py-3 px-6 rounded-lg hover:bg-slate-400 dark:hover:bg-slate-600 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 focus:ring-offset-2 hidden"
                    >
                        Открыть все
                    </button>
                </div>
                
                <div id="user-links-output" class="mt-6 flex flex-col space-y-2">
                    <!-- Сюда будут добавляться сгенерированные ссылки -->
                </div>
            </div>
             <button 
                id="back-from-user-generator-btn" 
                class="mt-6 w-full text-teal-600 dark:text-teal-400 font-medium py-3 px-6 rounded-lg hover:underline transition-all focus:outline-none"
            >
                ← Вернуться назад
            </button>
        </div>
        
        <!-- Новый раздел "Криптокошельки" (изначально скрытый) -->
        <div id="crypto-generator-page" class="hidden">
            <h1 class="text-3xl font-bold text-center text-slate-800 dark:text-slate-100 mb-6 transition-colors duration-500">
                Инструменты для антифрода
            </h1>
            <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 transition-colors duration-500">
                <h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4 transition-colors duration-500">
                    Криптокошельки
                </h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-4 transition-colors duration-500">
                    Вставьте один или несколько адресов кошельков, каждый с новой строки.
                </p>

                <textarea 
                    id="crypto-input" 
                    class="w-full h-32 p-3 text-sm rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 mb-4 transition-colors" 
                    placeholder="Например:
0x71c7656ec7ab88b098defb751b7401b5f6d8976f
TJRv2961d1QeJz7w1d6D38yP7R2b9c3x8C
EQC_5aQ9P8q9_GvQ9-0wD5vF7jE7q6vG7pQ9j2p"
                ></textarea>
                
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button 
                        id="crypto-generate-btn" 
                        class="w-full bg-teal-500 dark:bg-teal-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                    >
                        Сгенерировать ссылки
                    </button>
                    <button 
                        id="crypto-open-all-btn" 
                        class="w-full bg-slate-300 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-medium py-3 px-6 rounded-lg hover:bg-slate-400 dark:hover:bg-slate-600 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 focus:ring-offset-2 hidden"
                    >
                        Открыть все
                    </button>
                </div>
                
                <div id="crypto-links-output" class="mt-6 flex flex-col space-y-2">
                    <!-- Сюда будут добавляться сгенерированные ссылки -->
                </div>
            </div>
             <button 
                id="back-from-crypto-generator-btn" 
                class="mt-6 w-full text-teal-600 dark:text-teal-400 font-medium py-3 px-6 rounded-lg hover:underline transition-all focus:outline-none"
            >
                ← Вернуться назад
            </button>
        </div>

        <!-- Новый раздел "Пары кошельков → ссылки проверки" (изначально скрытый) -->
        <div id="pairs-generator-page" class="hidden">
            <h1 class="text-3xl font-bold text-center text-slate-800 dark:text-slate-100 mb-6 transition-colors duration-500">
                Инструменты для антифрода
            </h1>
            <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 transition-colors duration-500">
                <h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4 transition-colors duration-500">
                    Пары кошельков → ссылки проверки
                </h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-4 transition-colors duration-500">
                    Вставьте пары адресов (по одному набору в строке, разделение табом/пробелами). Укажите адрес, для которого проверка не нужна.
                </p>

                <label class="block text-sm text-slate-600 dark:text-slate-400 mb-1">Пары адресов</label>
                <textarea 
                    id="pairs-input" 
                    class="w-full h-32 p-3 text-sm rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 mb-4 transition-colors" 
                    placeholder="addrA\taddrB\naddrC addrD\naddrE,addrF"
                ></textarea>

                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
                    <div class="sm:col-span-2">
                        <label class="block text-sm text-slate-600 dark:text-slate-400 mb-1">Адрес, который исключить из проверки</label>
                        <input id="pairs-main" class="w-full p-3 text-sm rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 transition-colors" placeholder="Например: TZC3fi5Qt9jwVt8nMSFYuGANTXwJgzezKG" />
                    </div>
                    <div>
                        <label class="block text-sm text-slate-600 dark:text-slate-400 mb-1">Сервис проверки</label>
                        <select id="pairs-service" class="w-full p-3 text-sm rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400">
                            <option value="btech">BTech</option>
                            <option value="payplay">PayPlay</option>
                        </select>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button 
                        id="pairs-generate-btn" 
                        class="w-full bg-teal-500 dark:bg-teal-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                    >
                        Сгенерировать ссылки
                    </button>
                    <button 
                        id="pairs-open-all-btn" 
                        class="w-full bg-slate-300 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-medium py-3 px-6 rounded-lg hover:bg-slate-400 dark:hover:bg-slate-600 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 focus:ring-offset-2 hidden"
                    >
                        Открыть все
                    </button>
                </div>

                <div id="pairs-links-output" class="mt-6 flex flex-col space-y-2"></div>
            </div>
             <button 
                id="back-from-pairs-generator-btn" 
                class="mt-6 w-full text-teal-600 dark:text-teal-400 font-medium py-3 px-6 rounded-lg hover:underline transition-all focus:outline-none"
            >
                ← Вернуться назад
            </button>
        </div>

        <!-- Новый раздел "Анализ логов пользователей" (изначально скрытый) -->
        <div id="user-data-page" class="hidden">
            <h1 class="text-3xl font-bold text-center text-slate-800 dark:text-slate-100 mb-6 transition-colors duration-500">
                Инструменты для антифрода
            </h1>
            <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 transition-colors duration-500">
                <h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4 transition-colors duration-500">
                    Анализ данных пользователей
                </h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-4 transition-colors duration-500">
                    Вставьте данные пользователей в табличном формате. Будут извлечены уникальные значения ASN и устройств для копирования в Google Sheets.
                </p>

                <textarea 
                    id="user-data-input" 
                    class="w-full h-64 p-3 text-sm rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 mb-4 transition-colors" 
                    placeholder="Вставьте данные в формате:
Пользователь	IP адрес	ASN	Страна	Город	User agent	Регион	Создан	Действия
Godzillaaa (reports.garnish-3o@icloud.com)	31.44.245.197	50187	RU	Irkutsk	Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36	ru	September 18, 2025 03:03	
Godzillaaa (reports.garnish-3o@icloud.com)	193.106.0.56	59616	RU	Irkutsk	Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36	ru	September 16, 2025 20:14	"
                ></textarea>
                
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button 
                        id="user-data-analyze-btn" 
                        class="w-full bg-teal-500 dark:bg-teal-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                    >
                        Извлечь уникальные значения
                    </button>
                </div>
                <div class="mt-4 grid grid-cols-3 gap-3">
                    <button 
                        id="user-data-copy-asn-btn" 
                        class="w-full bg-slate-200 dark:bg-slate-800 text-slate-800 dark:text-slate-200 font-medium py-2 px-4 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 hidden"
                    >
                        Копировать ASN
                    </button>
                    <button 
                        id="user-data-copy-devices-btn" 
                        class="w-full bg-slate-200 dark:bg-slate-800 text-slate-800 dark:text-slate-200 font-medium py-2 px-4 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 hidden"
                    >
                        Копировать устройства
                    </button>
                    <button 
                        id="user-data-copy-table-btn" 
                        class="w-full bg-slate-300 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-medium py-2 px-4 rounded-lg hover:bg-slate-400 dark:hover:bg-slate-600 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 hidden"
                    >
                        Копировать таблицу
                    </button>
                </div>
                
                <div id="user-data-output" class="mt-6">
                    <!-- Сюда будут добавляться результаты анализа -->
                </div>
                <div id="copy-toast" class="pointer-events-none fixed left-1/2 -translate-x-1/2 bottom-8 z-50 opacity-0 transform translate-y-4 transition-all duration-300">
                    <div class="bg-slate-900 text-white text-sm py-2 px-4 rounded-full shadow-lg dark:bg-slate-800">
                        Скопировано
                    </div>
                </div>
            </div>
             <button 
                id="back-from-user-data-btn" 
                class="mt-6 w-full text-teal-600 dark:text-teal-400 font-medium py-3 px-6 rounded-lg hover:underline transition-all focus:outline-none"
            >
                ← Вернуться назад
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const homePage = document.getElementById('home-page');
            const generatorPage = document.getElementById('generator-page');
            const userGeneratorPage = document.getElementById('user-generator-page');
            const cryptoGeneratorPage = document.getElementById('crypto-generator-page');
            const userDataPage = document.getElementById('user-data-page');
            const pairsGeneratorPage = document.getElementById('pairs-generator-page');
            

            const goToGeneratorBtn = document.getElementById('go-to-generator-btn');
            const goToUserGeneratorBtn = document.getElementById('go-to-user-generator-btn');
            const goToCryptoGeneratorBtn = document.getElementById('go-to-crypto-generator-btn');
            const goToUserDataBtn = document.getElementById('go-to-user-data-btn');
            const goToPairsGeneratorBtn = document.getElementById('go-to-pairs-generator-btn');
            

            const backFromGeneratorBtn = document.getElementById('back-from-generator-btn');
            const backFromUserGeneratorBtn = document.getElementById('back-from-user-generator-btn');
            const backFromCryptoGeneratorBtn = document.getElementById('back-from-crypto-generator-btn');
            const backFromUserDataBtn = document.getElementById('back-from-user-data-btn');
            const backFromPairsGeneratorBtn = document.getElementById('back-from-pairs-generator-btn');
            


            const generateBtn = document.getElementById('generate-btn');
            const openAllBtn = document.getElementById('open-all-btn');
            const invoiceInput = document.getElementById('invoice-input');
            const linksOutput = document.getElementById('links-output');
            
            const userGenerateBtn = document.getElementById('user-generate-btn');
            const userOpenAllBtn = document.getElementById('user-open-all-btn');
            const userInput = document.getElementById('user-input');
            const userLinksOutput = document.getElementById('user-links-output');

            const cryptoGenerateBtn = document.getElementById('crypto-generate-btn');
            const cryptoOpenAllBtn = document.getElementById('crypto-open-all-btn');
            const cryptoInput = document.getElementById('crypto-input');
            const cryptoLinksOutput = document.getElementById('crypto-links-output');


            // Пары кошельков
            const pairsGenerateBtn = document.getElementById('pairs-generate-btn');
            const pairsOpenAllBtn = document.getElementById('pairs-open-all-btn');
            const pairsInput = document.getElementById('pairs-input');
            const pairsMain = document.getElementById('pairs-main');
            const pairsService = document.getElementById('pairs-service');
            const pairsLinksOutput = document.getElementById('pairs-links-output');

            const userDataAnalyzeBtn = document.getElementById('user-data-analyze-btn');
            const userDataInput = document.getElementById('user-data-input');
            const userDataOutput = document.getElementById('user-data-output');
            const userDataCopyTableBtn = document.getElementById('user-data-copy-table-btn');
            const userDataCopyAsnBtn = document.getElementById('user-data-copy-asn-btn');
            const userDataCopyDevicesBtn = document.getElementById('user-data-copy-devices-btn');
            const copyToast = document.getElementById('copy-toast');

            
            
            const canvas = document.getElementById('background-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];
            const particleCount = 200; // Увеличено количество частиц для большей плотности
            const maxDistance = 180; // Увеличено расстояние для линий
            // Объект для отслеживания позиции мыши
            const mouse = {
                x: undefined,
                y: undefined,
                radius: 150 // Радиус взаимодействия с мышью
            };

            // Слушатель событий для отслеживания движения мыши
            window.addEventListener('mousemove', (event) => {
                mouse.x = event.clientX;
                mouse.y = event.clientY;
            });

            // Класс для частицы
            class Particle {
                constructor(x, y, radius) {
                    this.x = x;
                    this.y = y;
                    this.baseRadius = radius; // Базовый радиус для анимации
                    this.radius = radius;
                    this.velocity = {
                        x: (Math.random() - 0.5) * 0.5,
                        y: (Math.random() - 0.5) * 0.5
                    };
                    this.phase = Math.random() * Math.PI * 2; // Фаза для анимации
                }

                draw(color) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                    ctx.fillStyle = color;
                    ctx.fill();
                    ctx.closePath();
                }

                update() {
                    // Анимация "дыхания"
                    this.phase += 0.05;
                    this.radius = this.baseRadius + Math.sin(this.phase) * 0.5;

                    // Проверка столкновения с границами канваса
                    if (this.x + this.radius > canvas.width || this.x - this.radius < 0) {
                        this.velocity.x = -this.velocity.x;
                    }
                    if (this.y + this.radius > canvas.height || this.y - this.radius < 0) {
                        this.velocity.y = -this.velocity.y;
                    }

                    // Логика плавного притяжения к мыши
                    if (mouse.x !== undefined && mouse.y !== undefined) {
                        const dx = mouse.x - this.x;
                        const dy = mouse.y - this.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);

                        if (distance < mouse.radius) {
                            const attractionFactor = 0.001; // Коэффициент силы притяжения (уменьшен)
                            const dampingFactor = 0.65; // Коэффициент затухания

                            // Вычисляем ускорение к курсору
                            this.velocity.x += dx * attractionFactor;
                            this.velocity.y += dy * attractionFactor;

                            // Применяем затухание для плавности
                            this.velocity.x *= dampingFactor;
                            this.velocity.y *= dampingFactor;
                        }
                    }

                    // Применение скорости
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;
                }
            }

            // Инициализация частиц
            function initParticles() {
                particles = [];
                for (let i = 0; i < particleCount; i++) {
                    const radius = Math.random() * 2 + 1;
                    const x = Math.random() * (canvas.width - radius * 2) + radius;
                    const y = Math.random() * (canvas.height - radius * 2) + radius;
                    particles.push(new Particle(x, y, radius));
                }
            }
            
            // Анимационный цикл
            function animate() {
                requestAnimationFrame(animate);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const isDark = document.documentElement.classList.contains('dark');
                const particleColor = isDark ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)';
                const lineColorBase = isDark ? 'rgba(255, 255, 255, ' : 'rgba(0, 0, 0, ';

                for (let i = 0; i < particles.length; i++) {
                    particles[i].update();
                    particles[i].draw(particleColor);
                    for (let j = i + 1; j < particles.length; j++) {
                        const dx = particles[i].x - particles[j].x;
                        const dy = particles[i].y - particles[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);

                        if (distance < maxDistance) {
                            const opacity = 0.5 - (distance / maxDistance) * 0.5; // Уменьшена прозрачность
                            ctx.beginPath();
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.strokeStyle = lineColorBase + opacity + ')';
                            ctx.lineWidth = 0.5;
                            ctx.stroke();
                            ctx.closePath();
                        }
                    }
                }
            }

            // Функция для обновления размеров canvas
            function updateCanvasSize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                initParticles();
            }

            // Изначальная настройка canvas
            updateCanvasSize();
            window.addEventListener('resize', updateCanvasSize);
            animate();

            // Автоматическая смена темы по системной настройке (как было)
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }


            // Логика переключения страниц
            const pageNames = {
                home: 'Инструменты для антифрода',
                generator: 'Длинный ID вывода',
                'user-generator': 'Открыть пользователей по ID',
                'crypto-generator': 'Обозреватель кошельков',
                'pairs-generator': 'Пары кошельков → ссылки проверки',
                'user-data': 'Анализ логов пользователей'
            };

            function setTitlesFor(pageId) {
                const base = 'Инструменты для антифрода';
                const name = pageNames[pageId] || base;
                document.title = pageId === 'home' ? base : `${name} — ${base}`;

                let container = null;
                if (pageId === 'home') container = homePage;
                else if (pageId === 'generator') container = generatorPage;
                else if (pageId === 'user-generator') container = userGeneratorPage;
                else if (pageId === 'crypto-generator') container = cryptoGeneratorPage;
                else if (pageId === 'pairs-generator') container = pairsGeneratorPage;
                else if (pageId === 'user-data') container = userDataPage;
                if (container) {
                    const h1 = container.querySelector('h1');
                    if (h1) h1.textContent = name;
                }
            }

            function showPage(pageId) {
                homePage.classList.add('hidden');
                generatorPage.classList.add('hidden');
                userGeneratorPage.classList.add('hidden');
                cryptoGeneratorPage.classList.add('hidden');
                pairsGeneratorPage.classList.add('hidden');
                userDataPage.classList.add('hidden');
                
                
                
                if (pageId === 'home') {
                    homePage.classList.remove('hidden');
                } else if (pageId === 'generator') {
                    generatorPage.classList.remove('hidden');
                } else if (pageId === 'user-generator') {
                    userGeneratorPage.classList.remove('hidden');
                } else if (pageId === 'crypto-generator') {
                    cryptoGeneratorPage.classList.remove('hidden');
                } else if (pageId === 'pairs-generator') {
                    pairsGeneratorPage.classList.remove('hidden');
                } else if (pageId === 'user-data') {
                    userDataPage.classList.remove('hidden');
                }
                setTitlesFor(pageId);
            }

            // Обработка хеша для открытия нужного раздела при загрузке/смене адреса
            function handleHashChange() {
                const hash = window.location.hash.replace('#', '');
                if (hash === 'generator' || hash === 'user-generator' || hash === 'crypto-generator' || hash === 'pairs-generator' || hash === 'user-data' || hash === 'home') {
                    showPage(hash);
                } else {
                    showPage('home');
                }
            }

            // Главные ссылки открываются сами (target="_blank"), обработчики не нужны
            
            backFromGeneratorBtn.addEventListener('click', () => { window.location.hash = 'home'; });
            backFromUserGeneratorBtn.addEventListener('click', () => { window.location.hash = 'home'; });
            backFromCryptoGeneratorBtn.addEventListener('click', () => { window.location.hash = 'home'; });
            backFromUserDataBtn.addEventListener('click', () => { window.location.hash = 'home'; });
            backFromPairsGeneratorBtn.addEventListener('click', () => { window.location.hash = 'home'; });
            
            

            // Инициализация отображения по текущему хешу и подписка на изменения
            handleHashChange();
            window.addEventListener('hashchange', handleHashChange);

            

            // URL builders для PayPlay/BTech (используются в разделе пар)
            const payplayBaseDeposits = 'https://crm.payplay.io/transactions/deposits';
            const payplayBaseWithdrawals = 'https://crm.payplay.io/transactions/withdrawals';
            function buildPayplayUrl(base, query) {
                const params = new URLSearchParams();
                params.set('search', query);
                return `${base}?${params.toString()}`;
            }
            const btechBase = 'https://backoffice.b-tech.tech/0b37f21a-43bf-41f7-a534-35ae9ce507da/transactions';
            const btechTables = ['customerAddress','foreignId','merchantAccountId','merchantUserId','paymentAddress','txid'];
            function buildBtechUrl(query) {
                const params = new URLSearchParams();
                btechTables.forEach((t) => {
                    params.append('table', `${t},${query}`);
                });
                return `${btechBase}?${params.toString()}`;
            }

            // Генерация ссылок для раздела "Пары кошельков"
            pairsGenerateBtn.addEventListener('click', () => {
                const raw = pairsInput.value.split('\n').map(s => s.trim()).filter(Boolean);
                const exclude = (pairsMain.value || '').trim();
                const service = pairsService.value; // 'btech' | 'payplay'

                pairsLinksOutput.innerHTML = '';
                pairsOpenAllBtn.classList.add('hidden');

                if (raw.length === 0) {
                    const p = document.createElement('p');
                    p.className = 'text-center text-slate-500 italic mt-4';
                    p.textContent = 'Пожалуйста, вставьте пары адресов.';
                    pairsLinksOutput.appendChild(p);
                    return;
                }

                // Собираем уникальные адреса из пар, исключая главный
                const unique = new Set();
                raw.forEach(line => {
                    // разделители: таб, запятая, 2+ пробела или один пробел
                    const parts = line.split(/[\t, ]+/).map(s => s.trim()).filter(Boolean);
                    if (parts.length >= 2) {
                        const a = parts[0];
                        const b = parts[1];
                        if (a && (!exclude || a !== exclude)) unique.add(a);
                        if (b && (!exclude || b !== exclude)) unique.add(b);
                    }
                });

                if (unique.size === 0) {
                    const p = document.createElement('p');
                    p.className = 'text-center text-slate-500 italic mt-4';
                    p.textContent = 'Нет адресов для генерации ссылок (возможно, все исключены).';
                    pairsLinksOutput.appendChild(p);
                    return;
                }

                const wallets = Array.from(unique);
                wallets.forEach(addr => {
                    if (service === 'btech') {
                        const url = buildBtechUrl(encodeURIComponent(addr));
                        const link = createLinkElement(`BTech: ${addr}`, url);
                        const copyBtn = createCopyButton(link);
                        pairsLinksOutput.appendChild(createLinkContainer(link, copyBtn));
                    } else if (service === 'payplay') {
                        const q = encodeURIComponent(addr);
                        const depUrl = buildPayplayUrl(payplayBaseDeposits, q);
                        const wdrUrl = buildPayplayUrl(payplayBaseWithdrawals, q);
                        const depLink = createLinkElement(`PayPlay Deposits: ${addr}`, depUrl);
                        const depCopy = createCopyButton(depLink);
                        pairsLinksOutput.appendChild(createLinkContainer(depLink, depCopy));
                        const wdrLink = createLinkElement(`PayPlay Withdrawals: ${addr}`, wdrUrl);
                        const wdrCopy = createCopyButton(wdrLink);
                        pairsLinksOutput.appendChild(createLinkContainer(wdrLink, wdrCopy));
                    }
                });

                if (pairsLinksOutput.querySelectorAll('a').length > 0) {
                    pairsOpenAllBtn.classList.remove('hidden');
                }
            });

            pairsOpenAllBtn.addEventListener('click', () => {
                const links = pairsLinksOutput.querySelectorAll('a');
                links.forEach(link => window.open(link.href, '_blank'));
            });

            // Функция для создания элемента ссылки
            function createLinkElement(text, href) {
                const link = document.createElement('a');
                link.href = href;
                link.textContent = text;
                link.target = "_blank"; 
                link.className = "text-teal-600 dark:text-teal-400 hover:text-teal-700 dark:hover:text-teal-300 hover:underline transition-colors text-sm truncate";
                return link;
            }

            // Функция для создания элемента кнопки копирования
            function createCopyButton(linkElement) {
                const copyBtn = document.createElement('button');
                copyBtn.className = "text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-400 transition-colors ml-4 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 rounded-md";
                copyBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
                        <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" />
                    </svg>
                `;
                copyBtn.title = "Скопировать ссылку";
                copyBtn.addEventListener('click', (event) => {
                    event.preventDefault(); 
                    const linkToCopy = linkElement.href;
                    const tempInput = document.createElement('textarea');
                    tempInput.value = linkToCopy;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    
                    const originalSVG = copyBtn.innerHTML;
                    copyBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 dark:text-green-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                    `;

                    setTimeout(() => {
                        copyBtn.innerHTML = originalSVG;
                    }, 2000);
                });
                return copyBtn;
            }

            // Функция для создания элемента-контейнера ссылки
            function createLinkContainer(link, copyBtn) {
                const linkContainer = document.createElement('div');
                linkContainer.className = "flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors duration-500";
                linkContainer.appendChild(link);
                linkContainer.appendChild(copyBtn);
                return linkContainer;
            }

            // Логика генератора инвойсов
            const invoiceBaseUrl = "https://lixog.com/ru/admin/app/asyncpayment/list?filter%5B_page%5D=1&filter%5B_per_page%5D=250&filter%5B_sort_by%5D=createdAt&filter%5B_sort_order%5D=DESC&filter%5Buuid%5D%5Btype%5D=3&filter%5Buuid%5D%5Bvalue%5D=";

            generateBtn.addEventListener('click', () => {
                const invoices = invoiceInput.value
                    .split('\n')
                    .map(invoice => invoice.trim())
                    .filter(invoice => invoice.length > 0);

                linksOutput.innerHTML = '';
                openAllBtn.classList.add('hidden'); 

                if (invoices.length === 0) {
                    const noLinks = document.createElement('p');
                    noLinks.className = "text-center text-slate-500 italic mt-4 transition-colors duration-500";
                    noLinks.textContent = "Пожалуйста, введите номера инвойсов.";
                    linksOutput.appendChild(noLinks);
                    return;
                }

                invoices.forEach(invoice => {
                    const fullUrl = `${invoiceBaseUrl}${encodeURIComponent(invoice)}`;
                    const link = createLinkElement(`Инвойс: ${invoice}`, fullUrl);
                    const copyBtn = createCopyButton(link);
                    linksOutput.appendChild(createLinkContainer(link, copyBtn));
                });

                if (invoices.length > 0) {
                    openAllBtn.classList.remove('hidden');
                }
            });

            openAllBtn.addEventListener('click', () => {
                const links = linksOutput.querySelectorAll('a');
                links.forEach(link => {
                    window.open(link.href, '_blank');
                });
            });

            // Логика генератора пользователей
            const userBaseUrl = "https://lixog.com/ru/admin/app/user/";

            userGenerateBtn.addEventListener('click', () => {
                const userIds = userInput.value
                    .split('\n')
                    .map(id => id.trim())
                    .filter(id => id.length > 0);

                userLinksOutput.innerHTML = '';
                userOpenAllBtn.classList.add('hidden'); 

                if (userIds.length === 0) {
                    const noLinks = document.createElement('p');
                    noLinks.className = "text-center text-slate-500 italic mt-4 transition-colors duration-500";
                    noLinks.textContent = "Пожалуйста, введите ID пользователей.";
                    userLinksOutput.appendChild(noLinks);
                    return;
                }

                userIds.forEach(userId => {
                    const fullUrl = `${userBaseUrl}${encodeURIComponent(userId)}/show`;
                    const link = createLinkElement(`Пользователь: ${userId}`, fullUrl);
                    const copyBtn = createCopyButton(link);
                    userLinksOutput.appendChild(createLinkContainer(link, copyBtn));
                });

                if (userIds.length > 0) {
                    userOpenAllBtn.classList.remove('hidden');
                }
            });

            userOpenAllBtn.addEventListener('click', () => {
                const links = userLinksOutput.querySelectorAll('a');
                links.forEach(link => {
                    window.open(link.href, '_blank');
                });
            });

            // Логика генератора криптокошельков
            const cryptoExplorers = {
                // UTXO
                btc: { name: 'Bitcoin', url: 'https://www.blockchain.com/btc/address/' },
                ltc: { name: 'Litecoin', url: 'https://blockchair.com/litecoin/address/' },
                doge: { name: 'Dogecoin', url: 'https://blockchair.com/dogecoin/address/' },
                dash: { name: 'Dash', url: 'https://blockchair.com/dash/address/' },
                bch: { name: 'Bitcoin Cash', url: 'https://blockchair.com/bitcoin-cash/address/' },

                // EVM-сети (одинаковый формат 0x...)
                eth: { name: 'Ethereum', url: 'https://etherscan.io/address/' },
                bsc: { name: 'BNB Smart Chain', url: 'https://bscscan.com/address/' },
                polygon: { name: 'Polygon', url: 'https://polygonscan.com/address/' },
                arbitrum: { name: 'Arbitrum', url: 'https://arbiscan.io/address/' },
                optimism: { name: 'Optimism', url: 'https://optimistic.etherscan.io/address/' },
                avalanche: { name: 'Avalanche C-Chain', url: 'https://snowtrace.io/address/' },
                fantom: { name: 'Fantom', url: 'https://ftmscan.com/address/' },
                base: { name: 'Base', url: 'https://basescan.org/address/' },
                zksync: { name: 'zkSync Era', url: 'https://explorer.zksync.io/address/' },

                // Account-based разные форматы
                tron: { name: 'TRON (TRC20)', url: 'https://tronscan.org/#/address/' },
                ton: { name: 'TON', url: 'https://tonviewer.com/' },
                xrp: { name: 'Ripple (XRP)', url: 'https://xrpscan.com/account/' },
                xlm: { name: 'Stellar (XLM)', url: 'https://stellarchain.io/address/' },
                ada: { name: 'Cardano (ADA)', url: 'https://cardanoscan.io/address/' },
                sol: { name: 'Solana', url: 'https://explorer.solana.com/address/' },
                near: { name: 'NEAR', url: 'https://explorer.near.org/accounts/' },
                algo: { name: 'Algorand (ALGO)', url: 'https://algoexplorer.io/address/' },
                tez: { name: 'Tezos', url: 'https://tzkt.io/' },
                bnbb: { name: 'BNB Beacon Chain', url: 'https://explorer.bnbchain.org/address/' }
            };
            
            // Определяет сеть по формату адреса
            function getWalletNetwork(address) {
                const normalizedAddress = address.trim();
                const networks = [];

                // EVM 0x-адреса → несколько сетей
                if (/^0x[a-fA-F0-9]{40}$/.test(normalizedAddress)) {
                    networks.push('eth','bsc','polygon','arbitrum','optimism','avalanche','fantom','base','zksync');
                }

                // TRON (Base58Check), обычно T + 33 символа
                if (/^T[a-zA-Z0-9]{33}$/.test(normalizedAddress)) {
                    networks.push('tron');
                }

                // TON (base64url, длина 48-49, начинается с U/Q/E)
                if (/^[UQE][a-zA-Z0-9_-]{47,48}$/.test(normalizedAddress)) {
                    networks.push('ton');
                }

                // BTC (legacy + segwit/bech32)
                if (/^1[a-km-zA-HJ-NP-Z1-9]{25,34}$/.test(normalizedAddress)
                 || /^3[a-km-zA-HJ-NP-Z1-9]{25,34}$/.test(normalizedAddress)
                 || /^bc1[ac-hj-np-z02-9]{25,89}$/.test(normalizedAddress)) {
                    networks.push('btc');
                }

                // BCH (cashaddr): bitcoincash:... или q/p префикс длиной ~42
                if (/^(bitcoincash:)?[qp][a-z0-9]{41,50}$/i.test(normalizedAddress)) {
                    networks.push('bch');
                }

                // Litecoin (legacy + bech32: ltc1)
                if (/^L[1-9A-HJ-NP-Za-km-z]{26,33}$/.test(normalizedAddress)
                 || /^M[1-9A-HJ-NP-Za-km-z]{26,33}$/.test(normalizedAddress)
                 || /^ltc1[ac-hj-np-z02-9]{25,89}$/.test(normalizedAddress)) {
                    networks.push('ltc');
                }

                // Dogecoin
                if (/^D[1-9A-HJ-NP-Za-km-z]{25,34}$/.test(normalizedAddress)) {
                    networks.push('doge');
                }

                // Dash
                if (/^X[1-9A-HJ-NP-Za-km-z]{25,34}$/.test(normalizedAddress)) {
                    networks.push('dash');
                }

                // XRP (Ripple) r + base58 25-35
                if (/^r[1-9A-HJ-NP-Za-km-z]{24,34}$/.test(normalizedAddress)) {
                    networks.push('xrp');
                }

                // Stellar (G + 55 base32)
                if (/^G[A-Z2-7]{55}$/.test(normalizedAddress)) {
                    networks.push('xlm');
                }

                // Cardano (bech32 addr1...)
                if (/^addr1[0-9a-z]{20,}$/i.test(normalizedAddress)) {
                    networks.push('ada');
                }

                // Solana (base58 32-44) — эвристика
                if (/^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(normalizedAddress)) {
                    networks.push('sol');
                }

                // NEAR (аккаунты заканчиваются на .near)
                if (/\.near$/i.test(normalizedAddress)) {
                    networks.push('near');
                }

                // Algorand (58 символов base32 A-Z2-7)
                if (/^[A-Z2-7]{58}$/i.test(normalizedAddress)) {
                    networks.push('algo');
                }

                // Tezos (tz1/tz2/tz3)
                if (/^tz[1-3][1-9A-HJ-NP-Za-km-z]{33}$/.test(normalizedAddress)) {
                    networks.push('tez');
                }

                // BNB Beacon Chain (bnb1...)
                if (/^bnb1[0-9a-z]{10,}$/i.test(normalizedAddress)) {
                    networks.push('bnbb');
                }
                
                return networks.length > 0 ? networks : null;
            }

            cryptoGenerateBtn.addEventListener('click', () => {
                const addresses = cryptoInput.value
                    .split('\n')
                    .map(address => address.trim())
                    .filter(address => address.length > 0);

                cryptoLinksOutput.innerHTML = '';
                cryptoOpenAllBtn.classList.add('hidden'); 

                if (addresses.length === 0) {
                    const noLinks = document.createElement('p');
                    noLinks.className = "text-center text-slate-500 italic mt-4 transition-colors duration-500";
                    noLinks.textContent = "Пожалуйста, введите адреса кошельков.";
                    cryptoLinksOutput.appendChild(noLinks);
                    return;
                }

                addresses.forEach(address => {
                    const networks = getWalletNetwork(address);
                    
                    if (networks) {
                        networks.forEach(network => {
                            const explorer = cryptoExplorers[network];
                            const fullUrl = `${explorer.url}${encodeURIComponent(address)}`;
                            const link = createLinkElement(`${explorer.name}: ${address}`, fullUrl);
                            const copyBtn = createCopyButton(link);
                            cryptoLinksOutput.appendChild(createLinkContainer(link, copyBtn));
                        });
                    } else {
                        const unknownLink = document.createElement('p');
                        unknownLink.className = "text-red-500 dark:text-red-400 text-sm italic mt-2";
                        unknownLink.textContent = `Адрес "${address}" не распознан.`;
                        cryptoLinksOutput.appendChild(unknownLink);
                    }
                });

                if (cryptoLinksOutput.querySelectorAll('a').length > 0) {
                    cryptoOpenAllBtn.classList.remove('hidden');
                }
            });

            cryptoOpenAllBtn.addEventListener('click', () => {
                const links = cryptoLinksOutput.querySelectorAll('a');
                links.forEach(link => {
                    window.open(link.href, '_blank');
                });
            });

            // Логика анализа данных пользователей
            let uniqueResults = { asn: new Set(), devices: new Set() };

            userDataAnalyzeBtn.addEventListener('click', () => {
                const inputData = userDataInput.value.trim();
                userDataOutput.innerHTML = '';
                userDataCopyTableBtn.classList.add('hidden');
                userDataCopyAsnBtn.classList.add('hidden');
                userDataCopyDevicesBtn.classList.add('hidden');

                if (!inputData) {
                    const noData = document.createElement('p');
                    noData.className = "text-center text-slate-500 italic mt-4 transition-colors duration-500";
                    noData.textContent = "Пожалуйста, вставьте данные пользователей.";
                    userDataOutput.appendChild(noData);
                    return;
                }

                // Парсим данные
                const lines = inputData.split('\n').filter(line => line.trim());
                if (lines.length < 2) {
                    const invalidData = document.createElement('p');
                    invalidData.className = "text-center text-red-500 italic mt-4 transition-colors duration-500";
                    invalidData.textContent = "Недостаточно данных для анализа.";
                    userDataOutput.appendChild(invalidData);
                    return;
                }

                // Сбрасываем результаты
                uniqueResults = { asn: new Set(), devices: new Set() };

                // Обрабатываем все строки (нет заголовка в вашем формате)
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    // Разделяем по табу
                    const columns = line.split('\t').filter(col => col.trim());
                    
                    if (columns.length >= 6) {
                        // ASN - 2-я колонка (индекс 1) - IP адрес, ASN, страна, город, user agent, регион
                        const asn = columns[1]?.trim();
                        if (asn && !isNaN(asn)) {
                            uniqueResults.asn.add(asn);
                        }

                        // User agent - 5-я колонка (индекс 4)
                        const userAgent = columns[4]?.trim();
                        if (userAgent && userAgent.startsWith('Mozilla/')) {
                            // Сохраняем полный User Agent
                            uniqueResults.devices.add(userAgent);
                        }
                    }
                }

                // Отображаем результаты
                displayResults();
            });


            function displayResults() {
                const asnArray = Array.from(uniqueResults.asn).sort();
                const devicesArray = Array.from(uniqueResults.devices).sort();

                // Создаем контейнер для результатов
                const resultsContainer = document.createElement('div');
                resultsContainer.className = "bg-slate-50 dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700";

                // Заголовок
                const title = document.createElement('h3');
                title.className = "text-lg font-semibold text-slate-700 dark:text-slate-200 mb-4 text-center";
                title.textContent = `Уникальные значения (ASN: ${asnArray.length}, Устройства: ${devicesArray.length})`;
                resultsContainer.appendChild(title);

                // Создаем таблицу
                const table = document.createElement('table');
                table.className = "w-full border-collapse";
                
                // Заголовки таблицы
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                headerRow.className = "border-b border-slate-300 dark:border-slate-600";
                
                const asnHeader = document.createElement('th');
                asnHeader.className = "text-left py-3 px-4 font-semibold text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-700";
                asnHeader.textContent = "ASN";
                
                const deviceHeader = document.createElement('th');
                deviceHeader.className = "text-left py-3 px-4 font-semibold text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-700";
                deviceHeader.textContent = "Устройство";
                
                headerRow.appendChild(asnHeader);
                headerRow.appendChild(deviceHeader);
                thead.appendChild(headerRow);
                table.appendChild(thead);

                // Тело таблицы
                const tbody = document.createElement('tbody');
                
                // Определяем максимальную длину для выравнивания строк
                const maxLength = Math.max(asnArray.length, devicesArray.length);
                
                for (let i = 0; i < maxLength; i++) {
                    const row = document.createElement('tr');
                    row.className = "border-b border-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors";
                    
                    // ASN колонка
                    const asnCell = document.createElement('td');
                    asnCell.className = "py-3 px-4 text-slate-600 dark:text-slate-300 font-mono text-sm";
                    asnCell.textContent = asnArray[i] || '';
                    
                    // Устройство колонка
                    const deviceCell = document.createElement('td');
                    deviceCell.className = "py-3 px-4 text-slate-600 dark:text-slate-300 text-sm";
                    deviceCell.textContent = devicesArray[i] || '';
                    
                    row.appendChild(asnCell);
                    row.appendChild(deviceCell);
                    tbody.appendChild(row);
                }
                
                table.appendChild(tbody);
                resultsContainer.appendChild(table);

                // Показываем кнопку копирования если есть результаты
                if (asnArray.length > 0 || devicesArray.length > 0) {
                    userDataCopyTableBtn.classList.remove('hidden');
                    userDataCopyAsnBtn.classList.remove('hidden');
                    userDataCopyDevicesBtn.classList.remove('hidden');
                }

                userDataOutput.appendChild(resultsContainer);
            }

            // Копировать таблицу
            userDataCopyTableBtn.addEventListener('click', () => {
                const { asnArray, devicesArray } = getResultsFromTable();
                
                // Формируем строку для копирования в табличном формате
                let copyText = 'ASN\tУстройство\n';
                const maxLength = Math.max(asnArray.length, devicesArray.length);
                for (let i = 0; i < maxLength; i++) {
                    const asn = asnArray[i] || '';
                    const device = devicesArray[i] || '';
                    copyText += `${asn}\t${device}\n`;
                }

                copyWithFallback(copyText, userDataCopyTableBtn, 'bg-slate-300 dark:bg-slate-700');
            });

            // Копировать только ASN (столбик)
            userDataCopyAsnBtn.addEventListener('click', () => {
                const { asnArray } = getResultsFromTable();
                const text = asnArray.join('\n');
                copyWithFallback(text, userDataCopyAsnBtn, 'bg-slate-200 dark:bg-slate-800');
            });

            // Копировать только устройства (столбик)
            userDataCopyDevicesBtn.addEventListener('click', () => {
                const { devicesArray } = getResultsFromTable();
                const text = devicesArray.join('\n');
                copyWithFallback(text, userDataCopyDevicesBtn, 'bg-slate-200 dark:bg-slate-800');
            });

            function getResultsFromTable() {
                const asnArray = [];
                const devicesArray = [];
                const table = userDataOutput.querySelector('table');
                if (!table) return { asnArray, devicesArray };
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const asn = (cells[0]?.textContent || '').trim();
                    const device = (cells[1]?.textContent || '').trim();
                    if (asn) asnArray.push(asn);
                    if (device) devicesArray.push(device);
                });
                return { asnArray, devicesArray };
            }

            function copyWithFallback(text, buttonEl, defaultBgClasses) {
                const onSuccess = () => {
                    // Анимация на кнопке
                    const originalText = buttonEl.textContent;
                    buttonEl.textContent = 'Скопировано!';
                    buttonEl.className = buttonEl.className.replace(defaultBgClasses, 'bg-green-500 dark:bg-green-600');
                    setTimeout(() => {
                        buttonEl.textContent = originalText;
                        buttonEl.className = buttonEl.className.replace('bg-green-500 dark:bg-green-600', defaultBgClasses);
                    }, 1200);
                    // Тост
                    showToast();
                 };

                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(onSuccess).catch(() => {
                        legacyCopy(text, onSuccess);
                    });
                } else {
                    legacyCopy(text, onSuccess);
                }
            }

            function legacyCopy(text, onSuccess) {
                try {
                    const temp = document.createElement('textarea');
                    temp.value = text;
                    temp.style.position = 'fixed';
                    temp.style.opacity = '0';
                    document.body.appendChild(temp);
                    temp.focus();
                    temp.select();
                    const ok = document.execCommand('copy');
                    document.body.removeChild(temp);
                    if (ok) onSuccess();
                    else throw new Error('execCommand failed');
                } catch (e) {
                    console.error('Ошибка копирования:', e);
                    alert('Не удалось скопировать данные. Выделите текст вручную.');
                }
            }

            function showToast() {
                if (!copyToast) return;
                copyToast.classList.remove('opacity-0', 'translate-y-4');
                copyToast.classList.add('opacity-100', 'translate-y-0');
                setTimeout(() => {
                    copyToast.classList.remove('opacity-100', 'translate-y-0');
                    copyToast.classList.add('opacity-0', 'translate-y-4');
                }, 1200);
            }
        });
    </script>
</body>
</html>
