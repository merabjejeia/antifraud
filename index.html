<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Инструменты для антифрода</title>
    
    <!-- Favicon - современный щит безопасности -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='shieldGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%2306b6d4;stop-opacity:1' /><stop offset='100%' style='stop-color:%230e7490;stop-opacity:1' /></linearGradient><linearGradient id='checkGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%2310b981;stop-opacity:1' /><stop offset='100%' style='stop-color:%23059669;stop-opacity:1' /></linearGradient></defs><path d='M50 10 L20 25 L20 45 C20 65 35 80 50 90 C65 80 80 65 80 45 L80 25 Z' fill='url(%23shieldGrad)' stroke='%23fff' stroke-width='2'/><path d='M35 45 L45 55 L65 35' stroke='url(%23checkGrad)' stroke-width='4' fill='none' stroke-linecap='round' stroke-linejoin='round'/><circle cx='50' cy='30' r='3' fill='%23fff' opacity='0.8'/></svg>">
    
    <!-- Подключение Tailwind CSS из CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Устанавливаем шрифт Inter */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Позиционирование canvas для фона */
        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-black flex items-center justify-center min-h-screen p-4 transition-colors duration-500">
    <!-- Анимированный фон Canvas -->
    <canvas id="background-canvas"></canvas>

    <!-- Основной контейнер-карточка -->
    <div class="bg-white/95 dark:bg-[#1f1f1f]/95 backdrop-blur-xl p-10 rounded-3xl shadow-2xl dark:shadow-2xl dark:shadow-black/80 border border-white/20 dark:border-[#2a2a2a]/60 w-full max-w-4xl relative z-10 transition-all duration-500">
        
        <!-- Главная страница (по умолчанию видимая) -->
        <div id="home-page" class="space-y-8">
            <!-- Заголовок в стиле Apple -->
            <div class="text-center space-y-4">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-slate-600 dark:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                </div>
                <h1 class="text-4xl font-semibold text-slate-900 dark:text-slate-100 transition-colors duration-500">
                    Инструменты для антифрода
                </h1>
                <p class="text-lg text-slate-500 dark:text-slate-400 max-w-2xl mx-auto leading-relaxed transition-colors duration-500">
                    Профессиональные инструменты для анализа данных, проверки пользователей и мониторинга криптовалютных транзакций
                </p>
            </div>
            <!-- Двухколоночная структура -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Левая колонка: Пользователи и данные -->
                <div class="space-y-6">
                    <div class="text-center space-y-2">
                        <div class="inline-flex items-center justify-center w-12 h-12 bg-slate-50 dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-600 dark:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
                            </svg>
                        </div>
                        <h2 class="text-xl font-medium text-slate-800 dark:text-slate-200">
                            Пользователи и данные
                        </h2>
                        <p class="text-sm text-slate-500 dark:text-slate-400">Анализ пользовательской активности</p>
                    </div>
                    
                    <a 
                        id="go-to-generator-btn" 
                        href="#generator"
                        class="group w-full bg-white dark:bg-[#1e1e1e] hover:bg-slate-50 dark:hover:bg-[#2a2a2a] text-slate-900 dark:text-slate-100 font-medium py-5 px-6 rounded-2xl shadow-sm hover:shadow-md border border-slate-200 dark:border-[#303030] transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-slate-500/20 focus:ring-offset-2 dark:focus:ring-offset-slate-900 flex items-center gap-4 transform hover:-translate-y-0.5"
                    >
                        <div class="flex items-center justify-center w-12 h-12 bg-slate-100 dark:bg-slate-700 rounded-xl group-hover:bg-slate-200 dark:group-hover:bg-slate-600 transition-colors duration-300 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-700 dark:text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-slate-900 dark:text-slate-100">Длинный ID вывода</div>
                            <div class="text-sm text-slate-500 dark:text-slate-400 mt-0.5">Поиск по инвойсам</div>
                        </div>
                    </a>
                    
                    <a 
                        id="go-to-user-generator-btn" 
                        href="#user-generator"
                        class="group w-full bg-white dark:bg-[#1e1e1e] hover:bg-slate-50 dark:hover:bg-[#2a2a2a] text-slate-900 dark:text-slate-100 font-medium py-5 px-6 rounded-2xl shadow-sm hover:shadow-md border border-slate-200 dark:border-[#303030] transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-slate-500/20 focus:ring-offset-2 dark:focus:ring-offset-slate-900 flex items-center gap-4 transform hover:-translate-y-0.5"
                    >
                        <div class="flex items-center justify-center w-12 h-12 bg-slate-100 dark:bg-slate-700 rounded-xl group-hover:bg-slate-200 dark:group-hover:bg-slate-600 transition-colors duration-300 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-700 dark:text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-slate-900 dark:text-slate-100">ID пользователя</div>
                            <div class="text-sm text-slate-500 dark:text-slate-400 mt-0.5">Поиск пользователей</div>
                        </div>
                    </a>
                    
                    <a 
                        id="go-to-user-data-btn"
                        href="#user-data"
                        class="group w-full bg-white dark:bg-[#1e1e1e] hover:bg-slate-50 dark:hover:bg-[#2a2a2a] text-slate-900 dark:text-slate-100 font-medium py-5 px-6 rounded-2xl shadow-sm hover:shadow-md border border-slate-200 dark:border-[#303030] transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-slate-500/20 focus:ring-offset-2 dark:focus:ring-offset-slate-900 flex items-center gap-4 transform hover:-translate-y-0.5"
                    >
                        <div class="flex items-center justify-center w-12 h-12 bg-slate-100 dark:bg-slate-700 rounded-xl group-hover:bg-slate-200 dark:group-hover:bg-slate-600 transition-colors duration-300 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-700 dark:text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                            </svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-slate-900 dark:text-slate-100">Анализ логов</div>
                            <div class="text-sm text-slate-500 dark:text-slate-400 mt-0.5">Извлечение данных</div>
                        </div>
                    </a>
                </div>

                <!-- Правая колонка: Криптовалюты и кошельки -->
                <div class="space-y-6">
                    <div class="text-center space-y-2">
                        <div class="inline-flex items-center justify-center w-12 h-12 bg-slate-50 dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-600 dark:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <h2 class="text-xl font-medium text-slate-800 dark:text-slate-200">
                            Криптовалюты и кошельки
                        </h2>
                        <p class="text-sm text-slate-500 dark:text-slate-400">Анализ блокчейн транзакций</p>
                    </div>
                    
                    <a 
                        id="go-to-crypto-generator-btn" 
                        href="#crypto-generator"
                        class="group w-full bg-white dark:bg-[#1e1e1e] hover:bg-slate-50 dark:hover:bg-[#2a2a2a] text-slate-900 dark:text-slate-100 font-medium py-5 px-6 rounded-2xl shadow-sm hover:shadow-md border border-slate-200 dark:border-[#303030] transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-slate-500/20 focus:ring-offset-2 dark:focus:ring-offset-slate-900 flex items-center gap-4 transform hover:-translate-y-0.5"
                    >
                        <div class="flex items-center justify-center w-12 h-12 bg-slate-100 dark:bg-slate-700 rounded-xl group-hover:bg-slate-200 dark:group-hover:bg-slate-600 transition-colors duration-300 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-700 dark:text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-slate-900 dark:text-slate-100">Обозреватель кошельков</div>
                            <div class="text-sm text-slate-500 dark:text-slate-400 mt-0.5">Просмотр адресов</div>
                        </div>
                    </a>
                    
                    <a 
                        id="go-to-pairs-generator-btn"
                        href="#pairs-generator"
                        class="group w-full bg-white dark:bg-[#1e1e1e] hover:bg-slate-50 dark:hover:bg-[#2a2a2a] text-slate-900 dark:text-slate-100 font-medium py-5 px-6 rounded-2xl shadow-sm hover:shadow-md border border-slate-200 dark:border-[#303030] transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-slate-500/20 focus:ring-offset-2 dark:focus:ring-offset-slate-900 flex items-center gap-4 transform hover:-translate-y-0.5"
                    >
                        <div class="flex items-center justify-center w-12 h-12 bg-slate-100 dark:bg-slate-700 rounded-xl group-hover:bg-slate-200 dark:group-hover:bg-slate-600 transition-colors duration-300 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-700 dark:text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                            </svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-slate-900 dark:text-slate-100">Пары кошельков</div>
                            <div class="text-sm text-slate-500 dark:text-slate-400 mt-0.5">Проверка связей</div>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- Раздел "Длинный ID вывода" (изначально скрытый) -->
        <div id="generator-page" class="hidden">
            <h1 class="text-3xl font-bold text-center text-slate-800 dark:text-slate-100 mb-6 transition-colors duration-500">
                Инструменты для антифрода
            </h1>
            <div class="bg-white dark:bg-[#202124] p-6 rounded-xl border border-slate-200 dark:border-[#2a2a2a] transition-colors duration-500">
                <h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4 transition-colors duration-500">
                    Длинный ID вывода
                </h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-4 transition-colors duration-500">
                    Вставьте один или несколько номеров инвойсов, каждый с новой строки.
                </p>

                <textarea 
                    id="invoice-input" 
                    class="w-full h-32 p-3 text-sm rounded-lg border border-slate-300 dark:border-[#3a3a3a] bg-white dark:bg-[#171717] text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 mb-4 transition-colors" 
                    placeholder="Например:
1757862788425449503
1757862788425449504
1757862788425449505"
                    aria-label="Введите номера инвойсов"
                    aria-describedby="invoice-error"
                ></textarea>
                <div id="invoice-error" class="text-red-500 dark:text-red-400 text-sm hidden mb-2" role="alert"></div>
                
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button 
                        id="generate-btn" 
                        class="w-full bg-teal-500 dark:bg-teal-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                    >
                        Сгенерировать ссылки
                    </button>
                    <button 
                        id="open-all-btn" 
                        class="w-full bg-slate-300 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-medium py-3 px-6 rounded-lg hover:bg-slate-400 dark:hover:bg-slate-600 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 focus:ring-offset-2 hidden"
                    >
                        Открыть все
                    </button>
                </div>
                
                <div id="invoice-count" class="mt-3 text-sm text-slate-600 dark:text-slate-400 hidden">Ссылок: 0</div>

                <div id="links-output" class="mt-6 flex flex-col space-y-2">
                    <!-- Сюда будут добавляться сгенерированные ссылки -->
                </div>
                <div id="invoice-manual-progress" class="mt-3 hidden">
                    <div class="flex items-center justify-between text-sm text-slate-600 dark:text-slate-400 mb-2">
                        <span>Открыто вручную:</span>
                        <span id="invoice-manual-count">0 из 0</span>
                    </div>
                    <div class="h-2 bg-slate-200 dark:bg-slate-800 rounded overflow-hidden">
                        <div id="invoice-manual-progress-bar" class="h-2 bg-blue-500 dark:bg-blue-400 transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
                <div id="invoice-progress" class="mt-4 hidden">
                    <div class="h-2 bg-slate-200 dark:bg-slate-800 rounded overflow-hidden">
                        <div id="invoice-progress-bar" class="h-2 bg-teal-500 dark:bg-teal-600" style="width: 0%"></div>
                    </div>
                    <div id="invoice-progress-text" class="mt-2 text-xs text-slate-500 dark:text-slate-400">Открыто 0 из 0</div>
                </div>
            </div>
             <button 
                id="back-from-generator-btn" 
                class="mt-6 w-full text-teal-600 dark:text-teal-400 font-medium py-3 px-6 rounded-lg hover:underline transition-all focus:outline-none"
            >
                ← Вернуться назад
            </button>
        </div>
        <!-- Новый раздел "Открытие пользователей" (изначально скрытый) -->
        <div id="user-generator-page" class="hidden">
            <h1 class="text-3xl font-bold text-center text-slate-800 dark:text-slate-100 mb-6 transition-colors duration-500">
                Инструменты для антифрода
            </h1>
            <div class="bg-white dark:bg-[#202124] p-6 rounded-xl border border-slate-200 dark:border-[#2a2a2a] transition-colors duration-500">
                <h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4 transition-colors duration-500">
                    Открыть пользователей по ID
                </h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-4 transition-colors duration-500">
                    Вставьте один или несколько ID пользователей, каждый с новой строки.
                </p>

                <textarea 
                    id="user-input" 
                    class="w-full h-32 p-3 text-sm rounded-lg border border-slate-300 dark:border-[#3a3a3a] bg-white dark:bg-[#171717] text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 mb-4 transition-colors" 
                    placeholder="Например:
23440844
23440845
23440846"
                ></textarea>
                
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button 
                        id="user-generate-btn" 
                        class="w-full bg-teal-500 dark:bg-teal-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                    >
                        Сгенерировать ссылки
                    </button>
                    <button 
                        id="user-open-all-btn" 
                        class="w-full bg-slate-300 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-medium py-3 px-6 rounded-lg hover:bg-slate-400 dark:hover:bg-slate-600 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 focus:ring-offset-2 hidden"
                    >
                        Открыть все
                    </button>
                </div>
                
                <div id="user-count" class="mt-3 text-sm text-slate-600 dark:text-slate-400 hidden">Ссылок: 0</div>

                <div id="user-links-output" class="mt-6 flex flex-col space-y-2">
                    <!-- Сюда будут добавляться сгенерированные ссылки -->
                </div>
                <div id="user-manual-progress" class="mt-3 hidden">
                    <div class="flex items-center justify-between text-sm text-slate-600 dark:text-slate-400 mb-2">
                        <span>Открыто вручную:</span>
                        <span id="user-manual-count">0 из 0</span>
                    </div>
                    <div class="h-2 bg-slate-200 dark:bg-slate-800 rounded overflow-hidden">
                        <div id="user-manual-progress-bar" class="h-2 bg-blue-500 dark:bg-blue-400 transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
                <div id="user-progress" class="mt-4 hidden">
                    <div class="h-2 bg-slate-200 dark:bg-slate-800 rounded overflow-hidden">
                        <div id="user-progress-bar" class="h-2 bg-teal-500 dark:bg-teal-600" style="width: 0%"></div>
                    </div>
                    <div id="user-progress-text" class="mt-2 text-xs text-slate-500 dark:text-slate-400">Открыто 0 из 0</div>
                </div>
            </div>
             <button 
                id="back-from-user-generator-btn" 
                class="mt-6 w-full text-teal-600 dark:text-teal-400 font-medium py-3 px-6 rounded-lg hover:underline transition-all focus:outline-none"
            >
                ← Вернуться назад
            </button>
        </div>
        
        <!-- Новый раздел "Криптокошельки" (изначально скрытый) -->
        <div id="crypto-generator-page" class="hidden">
            <h1 class="text-3xl font-bold text-center text-slate-800 dark:text-slate-100 mb-6 transition-colors duration-500">
                Инструменты для антифрода
            </h1>
            <div class="bg-white dark:bg-[#202124] p-6 rounded-xl border border-slate-200 dark:border-[#2a2a2a] transition-colors duration-500">
                <h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4 transition-colors duration-500">
                    Криптокошельки
                </h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-4 transition-colors duration-500">
                    Вставьте один или несколько адресов кошельков, каждый с новой строки.
                </p>

                <textarea 
                    id="crypto-input" 
                    class="w-full h-32 p-3 text-sm rounded-lg border border-slate-300 dark:border-[#3a3a3a] bg-white dark:bg-[#171717] text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 mb-4 transition-colors" 
                    placeholder="Например:
0x71c7656ec7ab88b098defb751b7401b5f6d8976f
TJRv2961d1QeJz7w1d6D38yP7R2b9c3x8C
EQC_5aQ9P8q9_GvQ9-0wD5vF7jE7q6vG7pQ9j2p"
                ></textarea>
                
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button 
                        id="crypto-generate-btn" 
                        class="w-full bg-teal-500 dark:bg-teal-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                    >
                        Сгенерировать ссылки
                    </button>
                    <button 
                        id="crypto-open-all-btn" 
                        class="w-full bg-slate-300 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-medium py-3 px-6 rounded-lg hover:bg-slate-400 dark:hover:bg-slate-600 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 focus:ring-offset-2 hidden"
                    >
                        Открыть все
                    </button>
                </div>
                
                <div id="crypto-count" class="mt-3 text-sm text-slate-600 dark:text-slate-400 hidden">Ссылок: 0</div>
                <div id="crypto-filters" class="mt-3 hidden">
                    <div class="flex flex-wrap gap-2 mb-3">
                        <button id="crypto-filter-all" class="px-3 py-1 text-xs bg-teal-500 text-white rounded-full">Все</button>
                        <button id="crypto-filter-utxo" class="px-3 py-1 text-xs bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-full">UTXO</button>
                        <button id="crypto-filter-evm" class="px-3 py-1 text-xs bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-full">EVM</button>
                        <button id="crypto-filter-account" class="px-3 py-1 text-xs bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-full">Account-based</button>
                    </div>
                </div>

                <div id="crypto-links-output" class="mt-6 flex flex-col space-y-2">
                    <!-- Сюда будут добавляться сгенерированные ссылки -->
                </div>
                <div id="crypto-manual-progress" class="mt-3 hidden">
                    <div class="flex items-center justify-between text-sm text-slate-600 dark:text-slate-400 mb-2">
                        <span>Открыто вручную:</span>
                        <span id="crypto-manual-count">0 из 0</span>
                    </div>
                    <div class="h-2 bg-slate-200 dark:bg-slate-800 rounded overflow-hidden">
                        <div id="crypto-manual-progress-bar" class="h-2 bg-blue-500 dark:bg-blue-400 transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
                <div id="crypto-progress" class="mt-4 hidden">
                    <div class="h-2 bg-slate-200 dark:bg-slate-800 rounded overflow-hidden">
                        <div id="crypto-progress-bar" class="h-2 bg-teal-500 dark:bg-teal-600" style="width: 0%"></div>
                    </div>
                    <div id="crypto-progress-text" class="mt-2 text-xs text-slate-500 dark:text-slate-400">Открыто 0 из 0</div>
                </div>
            </div>
             <button 
                id="back-from-crypto-generator-btn" 
                class="mt-6 w-full text-teal-600 dark:text-teal-400 font-medium py-3 px-6 rounded-lg hover:underline transition-all focus:outline-none"
            >
                ← Вернуться назад
            </button>
        </div>

        <!-- Новый раздел "Пары кошельков → ссылки проверки" (изначально скрытый) -->
        <div id="pairs-generator-page" class="hidden">
            <h1 class="text-3xl font-bold text-center text-slate-800 dark:text-slate-100 mb-6 transition-colors duration-500">
                Инструменты для антифрода
            </h1>
            <div class="bg-white dark:bg-[#202124] p-6 rounded-xl border border-slate-200 dark:border-[#2a2a2a] transition-colors duration-500">
                <h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4 transition-colors duration-500">
                    Пары кошельков → ссылки проверки
                </h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-4 transition-colors duration-500">
                    Вставьте пары адресов (по одному набору в строке, разделение табом/пробелами). Укажите адрес, для которого проверка не нужна.
                </p>

                <label class="block text-sm text-slate-600 dark:text-slate-400 mb-1">Пары адресов</label>
                <textarea 
                    id="pairs-input" 
                    class="w-full h-32 p-3 text-sm rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 mb-4 transition-colors" 
                    placeholder="addrA\taddrB\naddrC addrD\naddrE,addrF"
                ></textarea>

                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
                    <div class="sm:col-span-2">
                        <label class="block text-sm text-slate-600 dark:text-slate-400 mb-1">Адрес, который исключить из проверки</label>
                        <input id="pairs-main" class="w-full p-3 text-sm rounded-lg border border-slate-300 dark:border-[#3a3a3a] bg-white dark:bg-[#171717] text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 transition-colors" placeholder="Например: TZC3fi5Qt9jwVt8nMSFYuGANTXwJgzezKG" />
                    </div>
                    <div>
                        <label class="block text-sm text-slate-600 dark:text-slate-400 mb-1">Сервис проверки</label>
                        <select id="pairs-service" class="w-full p-3 text-sm rounded-lg border border-slate-300 dark:border-[#3a3a3a] bg-white dark:bg-[#171717] text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400">
                            <option value="btech">BTech</option>
                            <option value="payplay">PayPlay</option>
                        </select>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button 
                        id="pairs-generate-btn" 
                        class="w-full bg-teal-500 dark:bg-teal-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                    >
                        Сгенерировать ссылки
                    </button>
                    <button 
                        id="pairs-open-all-btn" 
                        class="w-full bg-slate-300 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-medium py-3 px-6 rounded-lg hover:bg-slate-400 dark:hover:bg-slate-600 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 focus:ring-offset-2 hidden"
                    >
                        Открыть все
                    </button>
                </div>

                <div id="pairs-count" class="mt-3 text-sm text-slate-600 dark:text-slate-400 hidden">Ссылок: 0</div>
                <div id="pairs-manual-progress" class="mt-3 hidden">
                    <div class="flex items-center justify-between text-sm text-slate-600 dark:text-slate-400 mb-2">
                        <span>Открыто вручную:</span>
                        <span id="pairs-manual-count">0 из 0</span>
                    </div>
                    <div class="h-2 bg-slate-200 dark:bg-slate-800 rounded overflow-hidden">
                        <div id="pairs-manual-progress-bar" class="h-2 bg-blue-500 dark:bg-blue-400 transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>

                <div id="pairs-links-output" class="mt-6 flex flex-col space-y-2"></div>
                <div id="pairs-progress" class="mt-4 hidden">
                    <div class="h-2 bg-slate-200 dark:bg-slate-800 rounded overflow-hidden">
                        <div id="pairs-progress-bar" class="h-2 bg-teal-500 dark:bg-teal-600" style="width: 0%"></div>
                    </div>
                    <div id="pairs-progress-text" class="mt-2 text-xs text-slate-500 dark:text-slate-400">Открыто 0 из 0</div>
                </div>
            </div>
             <button 
                id="back-from-pairs-generator-btn" 
                class="mt-6 w-full text-teal-600 dark:text-teal-400 font-medium py-3 px-6 rounded-lg hover:underline transition-all focus:outline-none"
            >
                ← Вернуться назад
            </button>
        </div>

        <!-- Новый раздел "Анализ логов пользователей" (изначально скрытый) -->
        <div id="user-data-page" class="hidden">
            <h1 class="text-3xl font-bold text-center text-slate-800 dark:text-slate-100 mb-6 transition-colors duration-500">
                Инструменты для антифрода
            </h1>
            <div class="bg-white dark:bg-[#202124] p-6 rounded-xl border border-slate-200 dark:border-[#2a2a2a] transition-colors duration-500">
                <h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4 transition-colors duration-500">
                    Анализ данных пользователей
                </h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-4 transition-colors duration-500">
                    Вставьте данные пользователей в табличном формате. Будут извлечены уникальные значения ASN и устройств для копирования.
                </p>

                <textarea 
                    id="user-data-input" 
                    class="w-full h-64 p-3 text-sm rounded-lg border border-slate-300 dark:border-[#3a3a3a] bg-white dark:bg-[#171717] text-slate-700 dark:text-slate-200 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 mb-4 transition-colors" 
                    placeholder="Вставьте данные в формате:
Пользователь	IP адрес	ASN	Страна	Город	User agent	Регион	Создан	Действия
Ivanov (ivan@icloud.com)	31.44.215.197	50187	RU	Irkutsk	Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36	ru	September 18, 2025 03:03	
Ivanov (ivan@icloud.com)	193.406.0.56	59616	RU	Irkutsk	Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36	ru	September 16, 2025 20:14	"
                ></textarea>
                
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button 
                        id="user-data-analyze-btn" 
                        class="w-full bg-teal-500 dark:bg-teal-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-teal-600 dark:hover:bg-teal-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 focus:ring-offset-2"
                    >
                        Извлечь уникальные значения
                    </button>
                </div>
                <div class="mt-4 grid grid-cols-3 gap-3">
                    <button 
                        id="user-data-copy-asn-btn" 
                        class="w-full bg-slate-200 dark:bg-slate-800 text-slate-800 dark:text-slate-200 font-medium py-2 px-4 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 hidden"
                    >
                        Копировать ASN
                    </button>
                    <button 
                        id="user-data-copy-devices-btn" 
                        class="w-full bg-slate-200 dark:bg-slate-800 text-slate-800 dark:text-slate-200 font-medium py-2 px-4 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 hidden"
                    >
                        Копировать устройства
                    </button>
                    <button 
                        id="user-data-copy-table-btn" 
                        class="w-full bg-slate-300 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-medium py-2 px-4 rounded-lg hover:bg-slate-400 dark:hover:bg-slate-600 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-slate-400 dark:focus:ring-slate-500 hidden"
                    >
                        Копировать таблицу
                    </button>
                </div>
                
                <div id="user-data-output" class="mt-6">
                    <!-- Сюда будут добавляться результаты анализа -->
                </div>
                <div id="copy-toast" class="pointer-events-none fixed left-1/2 -translate-x-1/2 bottom-8 z-50 opacity-0 transform translate-y-4 transition-all duration-300">
                    <div class="bg-slate-900 text-white text-sm py-2 px-4 rounded-full shadow-lg dark:bg-slate-800">
                        Скопировано
                    </div>
                </div>
            </div>
             <button 
                id="back-from-user-data-btn" 
                class="mt-6 w-full text-teal-600 dark:text-teal-400 font-medium py-3 px-6 rounded-lg hover:underline transition-all focus:outline-none"
            >
                ← Вернуться назад
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const homePage = document.getElementById('home-page');
            const generatorPage = document.getElementById('generator-page');
            const userGeneratorPage = document.getElementById('user-generator-page');
            const cryptoGeneratorPage = document.getElementById('crypto-generator-page');
            const userDataPage = document.getElementById('user-data-page');
            const pairsGeneratorPage = document.getElementById('pairs-generator-page');
            

            const goToGeneratorBtn = document.getElementById('go-to-generator-btn');
            const goToUserGeneratorBtn = document.getElementById('go-to-user-generator-btn');
            const goToCryptoGeneratorBtn = document.getElementById('go-to-crypto-generator-btn');
            const goToUserDataBtn = document.getElementById('go-to-user-data-btn');
            const goToPairsGeneratorBtn = document.getElementById('go-to-pairs-generator-btn');
            

            const backFromGeneratorBtn = document.getElementById('back-from-generator-btn');
            const backFromUserGeneratorBtn = document.getElementById('back-from-user-generator-btn');
            const backFromCryptoGeneratorBtn = document.getElementById('back-from-crypto-generator-btn');
            const backFromUserDataBtn = document.getElementById('back-from-user-data-btn');
            const backFromPairsGeneratorBtn = document.getElementById('back-from-pairs-generator-btn');
            


            const generateBtn = document.getElementById('generate-btn');
            const openAllBtn = document.getElementById('open-all-btn');
            const invoiceInput = document.getElementById('invoice-input');
            const linksOutput = document.getElementById('links-output');
            
            const userGenerateBtn = document.getElementById('user-generate-btn');
            const userOpenAllBtn = document.getElementById('user-open-all-btn');
            const userInput = document.getElementById('user-input');
            const userLinksOutput = document.getElementById('user-links-output');

            const cryptoGenerateBtn = document.getElementById('crypto-generate-btn');
            const cryptoOpenAllBtn = document.getElementById('crypto-open-all-btn');
            const cryptoInput = document.getElementById('crypto-input');
            const cryptoLinksOutput = document.getElementById('crypto-links-output');

            // Прогресс-элементы
            const invoiceProgress = document.getElementById('invoice-progress');
            const invoiceProgressBar = document.getElementById('invoice-progress-bar');
            const invoiceProgressText = document.getElementById('invoice-progress-text');
            const userProgress = document.getElementById('user-progress');
            const userProgressBar = document.getElementById('user-progress-bar');
            const userProgressText = document.getElementById('user-progress-text');
            const cryptoProgress = document.getElementById('crypto-progress');
            const cryptoProgressBar = document.getElementById('crypto-progress-bar');
            const cryptoProgressText = document.getElementById('crypto-progress-text');


            // Пары кошельков
            const pairsGenerateBtn = document.getElementById('pairs-generate-btn');
            const pairsOpenAllBtn = document.getElementById('pairs-open-all-btn');
            const pairsInput = document.getElementById('pairs-input');
            const pairsMain = document.getElementById('pairs-main');
            const pairsService = document.getElementById('pairs-service');
            const pairsLinksOutput = document.getElementById('pairs-links-output');
            const pairsCount = document.getElementById('pairs-count');
            const pairsProgress = document.getElementById('pairs-progress');
            const pairsProgressBar = document.getElementById('pairs-progress-bar');
            const pairsProgressText = document.getElementById('pairs-progress-text');
            const pairsManualProgress = document.getElementById('pairs-manual-progress');
            const pairsManualCount = document.getElementById('pairs-manual-count');
            const pairsManualProgressBar = document.getElementById('pairs-manual-progress-bar');

            // Manual progress elements for other sections
            const invoiceManualProgress = document.getElementById('invoice-manual-progress');
            const invoiceManualCount = document.getElementById('invoice-manual-count');
            const invoiceManualProgressBar = document.getElementById('invoice-manual-progress-bar');
            const userManualProgress = document.getElementById('user-manual-progress');
            const userManualCount = document.getElementById('user-manual-count');
            const userManualProgressBar = document.getElementById('user-manual-progress-bar');
            const cryptoManualProgress = document.getElementById('crypto-manual-progress');
            const cryptoManualCount = document.getElementById('crypto-manual-count');
            const cryptoManualProgressBar = document.getElementById('crypto-manual-progress-bar');

            // Link counters
            const invoiceCount = document.getElementById('invoice-count');
            const userCount = document.getElementById('user-count');
            const cryptoCount = document.getElementById('crypto-count');

            // Crypto filters
            const cryptoFilters = document.getElementById('crypto-filters');
            const cryptoFilterAll = document.getElementById('crypto-filter-all');
            const cryptoFilterUtxo = document.getElementById('crypto-filter-utxo');
            const cryptoFilterEvm = document.getElementById('crypto-filter-evm');
            const cryptoFilterAccount = document.getElementById('crypto-filter-account');

            const userDataAnalyzeBtn = document.getElementById('user-data-analyze-btn');
            const userDataInput = document.getElementById('user-data-input');
            const userDataOutput = document.getElementById('user-data-output');
            const userDataCopyTableBtn = document.getElementById('user-data-copy-table-btn');
            const userDataCopyAsnBtn = document.getElementById('user-data-copy-asn-btn');
            const userDataCopyDevicesBtn = document.getElementById('user-data-copy-devices-btn');
            const copyToast = document.getElementById('copy-toast');

            
            
            const canvas = document.getElementById('background-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];
            const particleCount = 200; // Увеличено количество частиц для большей плотности
            const maxDistance = 180; // Увеличено расстояние для линий между частицами
            const mouseLineDistance = 160; // Радиус соединения частиц с курсором ниточками
            // Объект для отслеживания позиции мыши
            const mouse = {
                x: undefined,
                y: undefined,
                radius: 150 // Радиус взаимодействия с мышью
            };

            // Слушатель событий для отслеживания движения мыши
            window.addEventListener('mousemove', (event) => {
                mouse.x = event.clientX;
                mouse.y = event.clientY;
            });

            // Класс для частицы
            class Particle {
                constructor(x, y, radius) {
                    this.x = x;
                    this.y = y;
                    this.baseRadius = radius; // Базовый радиус для анимации
                    this.radius = radius;
                    this.velocity = {
                        x: (Math.random() - 0.5) * 0.9,
                        y: (Math.random() - 0.5) * 0.9
                    };
                    this.phase = Math.random() * Math.PI * 2; // Фаза для анимации
                }

                draw(color) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                    ctx.fillStyle = color;
                    ctx.fill();
                    ctx.closePath();
                }

                update() {
                    // Анимация "дыхания"
                    this.phase += 0.05;
                    this.radius = this.baseRadius + Math.sin(this.phase) * 0.5;

                    // Небольшой случайный дрейф для хаотичности
                    this.velocity.x += (Math.random() - 0.5) * 0.05;
                    this.velocity.y += (Math.random() - 0.5) * 0.05;

                    // Ограничение максимальной скорости
                    const maxSpeed = 0.5;
                    const speed = Math.hypot(this.velocity.x, this.velocity.y);
                    if (speed > maxSpeed) {
                        this.velocity.x = (this.velocity.x / speed) * maxSpeed;
                        this.velocity.y = (this.velocity.y / speed) * maxSpeed;
                    }

                    // Проверка столкновения с границами канваса
                    if (this.x + this.radius > canvas.width || this.x - this.radius < 0) {
                        this.velocity.x = -this.velocity.x;
                    }
                    if (this.y + this.radius > canvas.height || this.y - this.radius < 0) {
                        this.velocity.y = -this.velocity.y;
                    }

                    // Применение скорости
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;
                }
            }

            // Инициализация частиц
            function initParticles() {
                particles = [];
                for (let i = 0; i < particleCount; i++) {
                    const radius = Math.random() * 2 + 1;
                    const x = Math.random() * (canvas.width - radius * 2) + radius;
                    const y = Math.random() * (canvas.height - radius * 2) + radius;
                    particles.push(new Particle(x, y, radius));
                }
            }
            
            // Анимационный цикл
            function animate() {
                requestAnimationFrame(animate);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const isDark = document.documentElement.classList.contains('dark');
                const particleColor = isDark ? 'rgba(255, 255, 255, 0.5)' : 'rgba(0, 0, 0, 0.22)';
                const lineColorBase = isDark ? 'rgba(255, 255, 255, ' : 'rgba(0, 0, 0, ';

                for (let i = 0; i < particles.length; i++) {
                    particles[i].update();
                    particles[i].draw(particleColor);
                    for (let j = i + 1; j < particles.length; j++) {
                        const dx = particles[i].x - particles[j].x;
                        const dy = particles[i].y - particles[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);

                        if (distance < maxDistance) {
                            const opacity = isDark ? (0.65 - (distance / maxDistance) * 0.65) : (0.5 - (distance / maxDistance) * 0.5);
                            ctx.beginPath();
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.strokeStyle = lineColorBase + opacity + ')';
                            ctx.lineWidth = 0.5;
                            ctx.stroke();
                            ctx.closePath();
                        }
                    }
                }

                // Соединяем близкие к курсору частицы нитями
                if (mouse.x !== undefined && mouse.y !== undefined) {
                    for (let i = 0; i < particles.length; i++) {
                        const dx = particles[i].x - mouse.x;
                        const dy = particles[i].y - mouse.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        if (dist < mouseLineDistance) {
                            const opacity = isDark ? (0.6 - (dist / mouseLineDistance) * 0.6) : (0.45 - (dist / mouseLineDistance) * 0.45);
                            ctx.beginPath();
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(mouse.x, mouse.y);
                            ctx.strokeStyle = lineColorBase + opacity + ')';
                            ctx.lineWidth = 0.6;
                            ctx.stroke();
                            ctx.closePath();
                        }
                    }
                }
            }

            // Функция для обновления размеров canvas
            function updateCanvasSize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                initParticles();
            }

            // Изначальная настройка canvas
            updateCanvasSize();
            window.addEventListener('resize', updateCanvasSize);
            animate();

            // Автоматическая смена темы по системной настройке (как было)
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }


            // Логика переключения страниц
            const pageNames = {
                home: 'Инструменты для антифрода',
                generator: 'Длинный ID вывода',
                'user-generator': 'Открыть пользователей по ID',
                'crypto-generator': 'Обозреватель кошельков',
                'pairs-generator': 'Пары кошельков → ссылки проверки',
                'user-data': 'Анализ логов пользователей'
            };

            function setTitlesFor(pageId) {
                const base = 'Инструменты для антифрода';
                const name = pageNames[pageId] || base;
                document.title = pageId === 'home' ? base : `${name} — ${base}`;

                let container = null;
                if (pageId === 'home') container = homePage;
                else if (pageId === 'generator') container = generatorPage;
                else if (pageId === 'user-generator') container = userGeneratorPage;
                else if (pageId === 'crypto-generator') container = cryptoGeneratorPage;
                else if (pageId === 'pairs-generator') container = pairsGeneratorPage;
                else if (pageId === 'user-data') container = userDataPage;
                if (container) {
                    const h1 = container.querySelector('h1');
                    if (h1) h1.textContent = name;
                }
            }

            function showPage(pageId) {
                homePage.classList.add('hidden');
                generatorPage.classList.add('hidden');
                userGeneratorPage.classList.add('hidden');
                cryptoGeneratorPage.classList.add('hidden');
                pairsGeneratorPage.classList.add('hidden');
                userDataPage.classList.add('hidden');
                
                
                
                if (pageId === 'home') {
                    homePage.classList.remove('hidden');
                } else if (pageId === 'generator') {
                    generatorPage.classList.remove('hidden');
                } else if (pageId === 'user-generator') {
                    userGeneratorPage.classList.remove('hidden');
                } else if (pageId === 'crypto-generator') {
                    cryptoGeneratorPage.classList.remove('hidden');
                } else if (pageId === 'pairs-generator') {
                    pairsGeneratorPage.classList.remove('hidden');
                } else if (pageId === 'user-data') {
                    userDataPage.classList.remove('hidden');
                }
                setTitlesFor(pageId);
            }

            // Обработка хеша для открытия нужного раздела при загрузке/смене адреса
            function handleHashChange() {
                const hash = window.location.hash.replace('#', '');
                if (hash === 'generator' || hash === 'user-generator' || hash === 'crypto-generator' || hash === 'pairs-generator' || hash === 'user-data' || hash === 'home') {
                    showPage(hash);
                } else {
                    showPage('home');
                }
            }

            // Главные ссылки открываются сами (target="_blank"), обработчики не нужны
            
            backFromGeneratorBtn.addEventListener('click', () => { window.location.hash = 'home'; });
            backFromUserGeneratorBtn.addEventListener('click', () => { window.location.hash = 'home'; });
            backFromCryptoGeneratorBtn.addEventListener('click', () => { window.location.hash = 'home'; });
            backFromUserDataBtn.addEventListener('click', () => { window.location.hash = 'home'; });
            backFromPairsGeneratorBtn.addEventListener('click', () => { window.location.hash = 'home'; });
            
            

            // Инициализация отображения по текущему хешу и подписка на изменения
            handleHashChange();
            window.addEventListener('hashchange', handleHashChange);

            

            // URL builders для PayPlay/BTech (используются в разделе пар)
            const payplayBaseDeposits = 'https://crm.payplay.io/transactions/deposits';
            const payplayBaseWithdrawals = 'https://crm.payplay.io/transactions/withdrawals';
            function buildPayplayUrl(base, query) {
                const params = new URLSearchParams();
                params.set('search', query);
                return `${base}?${params.toString()}`;
            }
            const btechBase = 'https://backoffice.b-tech.tech/0b37f21a-43bf-41f7-a534-35ae9ce507da/transactions';
            const btechTables = ['customerAddress','foreignId','merchantAccountId','merchantUserId','paymentAddress','txid'];
            function buildBtechUrl(query) {
                const params = new URLSearchParams();
                btechTables.forEach((t) => {
                    params.append('table', `${t},${query}`);
                });
                return `${btechBase}?${params.toString()}`;
            }

            // Генерация ссылок для раздела "Пары кошельков"
            pairsGenerateBtn.addEventListener('click', () => {
                const raw = pairsInput.value.split('\n').map(s => s.trim()).filter(Boolean);
                const exclude = (pairsMain.value || '').trim();
                const service = pairsService.value; // 'btech' | 'payplay'

                pairsLinksOutput.innerHTML = '';
                pairsOpenAllBtn.classList.add('hidden');
                if (pairsCount) {
                    pairsCount.textContent = 'Ссылок: 0';
                    pairsCount.classList.add('hidden');
                }
                if (pairsProgress && pairsProgressBar && pairsProgressText) {
                    pairsProgress.classList.add('hidden');
                    pairsProgressBar.style.width = '0%';
                    pairsProgressText.textContent = 'Открыто 0 из 0';
                }
                if (pairsManualProgress && pairsManualCount && pairsManualProgressBar) {
                    pairsManualProgress.classList.add('hidden');
                    pairsManualCount.textContent = '0 из 0';
                    pairsManualProgressBar.style.width = '0%';
                }

                if (raw.length === 0) {
                    const p = document.createElement('p');
                    p.className = 'text-center text-slate-500 italic mt-4';
                    p.textContent = 'Пожалуйста, вставьте пары адресов.';
                    pairsLinksOutput.appendChild(p);
                    return;
                }

                // Собираем уникальные адреса из пар, исключая главный
                const unique = new Set();
                raw.forEach(line => {
                    // разделители: таб, запятая, 2+ пробела или один пробел
                    const parts = line.split(/[\t, ]+/).map(s => s.trim()).filter(Boolean);
                    if (parts.length >= 2) {
                        const a = parts[0];
                        const b = parts[1];
                        if (a && (!exclude || a !== exclude)) unique.add(a);
                        if (b && (!exclude || b !== exclude)) unique.add(b);
                    }
                });

                if (unique.size === 0) {
                    const p = document.createElement('p');
                    p.className = 'text-center text-slate-500 italic mt-4';
                    p.textContent = 'Нет адресов для генерации ссылок (возможно, все исключены).';
                    pairsLinksOutput.appendChild(p);
                    return;
                }

                const wallets = Array.from(unique);
                
                // Optimize rendering for large numbers of wallets
                if (wallets.length > 20) {
                    const progressInfo = document.createElement('div');
                    progressInfo.className = 'text-center text-slate-500 dark:text-slate-400 text-sm mb-4';
                    progressInfo.textContent = `Генерируем ссылки для ${wallets.length} кошельков...`;
                    pairsLinksOutput.appendChild(progressInfo);
                    
                    let processed = 0;
                    const processWallet = (index) => {
                        if (index >= wallets.length) {
                            progressInfo.remove();
                            return;
                        }
                        
                        const addr = wallets[index];
                        if (service === 'btech') {
                            const url = buildBtechUrl(encodeURIComponent(addr));
                            const link = createLinkElement(`BTech: ${addr}`, url, 'pairs');
                            const copyBtn = createCopyButton(link);
                            pairsLinksOutput.appendChild(createLinkContainer(link, copyBtn));
                        } else if (service === 'payplay') {
                            const q = encodeURIComponent(addr);
                            const depUrl = buildPayplayUrl(payplayBaseDeposits, q);
                            const wdrUrl = buildPayplayUrl(payplayBaseWithdrawals, q);
                            const depLink = createLinkElement(`PayPlay Deposits: ${addr}`, depUrl, 'pairs');
                            const depCopy = createCopyButton(depLink);
                            pairsLinksOutput.appendChild(createLinkContainer(depLink, depCopy));
                            const wdrLink = createLinkElement(`PayPlay Withdrawals: ${addr}`, wdrUrl, 'pairs');
                            const wdrCopy = createCopyButton(wdrLink);
                            pairsLinksOutput.appendChild(createLinkContainer(wdrLink, wdrCopy));
                        }
                        
                        processed++;
                        progressInfo.textContent = `Генерируем ссылки для ${wallets.length} кошельков... (${processed}/${wallets.length})`;
                        
                        // Use setTimeout to prevent blocking
                        setTimeout(() => processWallet(index + 1), 10);
                    };
                    
                    processWallet(0);
                } else {
                    // For small numbers, process immediately
                    wallets.forEach(addr => {
                        if (service === 'btech') {
                            const url = buildBtechUrl(encodeURIComponent(addr));
                            const link = createLinkElement(`BTech: ${addr}`, url, 'pairs');
                            const copyBtn = createCopyButton(link);
                            pairsLinksOutput.appendChild(createLinkContainer(link, copyBtn));
                        } else if (service === 'payplay') {
                            const q = encodeURIComponent(addr);
                            const depUrl = buildPayplayUrl(payplayBaseDeposits, q);
                            const wdrUrl = buildPayplayUrl(payplayBaseWithdrawals, q);
                            const depLink = createLinkElement(`PayPlay Deposits: ${addr}`, depUrl, 'pairs');
                            const depCopy = createCopyButton(depLink);
                            pairsLinksOutput.appendChild(createLinkContainer(depLink, depCopy));
                            const wdrLink = createLinkElement(`PayPlay Withdrawals: ${addr}`, wdrUrl, 'pairs');
                            const wdrCopy = createCopyButton(wdrLink);
                            pairsLinksOutput.appendChild(createLinkContainer(wdrLink, wdrCopy));
                        }
                    });
                }

                // Update UI after processing
                const updateUI = () => {
                    const links = pairsLinksOutput.querySelectorAll('a');
                    if (links.length > 0) {
                        pairsOpenAllBtn.classList.remove('hidden');
                        if (pairsCount) {
                            pairsCount.textContent = `Ссылок: ${links.length}`;
                            pairsCount.classList.remove('hidden');
                        }
                    }
                };

                if (wallets.length <= 20) {
                    // For small numbers, update immediately
                    updateUI();
                } else {
                    // For large numbers, update after processing
                    const checkCompletion = () => {
                        const links = pairsLinksOutput.querySelectorAll('a');
                        if (links.length === wallets.length * (service === 'payplay' ? 2 : 1)) {
                            updateUI();
                        } else {
                            setTimeout(checkCompletion, 100);
                        }
                    };
                    checkCompletion();
                }
            });

            pairsOpenAllBtn.addEventListener('click', () => {
                const links = pairsLinksOutput.querySelectorAll('a');
                openLinksThrottled(links, 8, {
                    container: pairsProgress,
                    bar: pairsProgressBar,
                    text: pairsProgressText
                });
            });

            // Функция для создания элемента ссылки с отслеживанием кликов
            function createLinkElement(text, href, sectionId = null) {
                const link = document.createElement('a');
                link.href = href;
                link.textContent = text;
                link.target = "_blank"; 
                link.className = "text-teal-600 dark:text-teal-400 hover:text-teal-700 dark:hover:text-teal-300 hover:underline transition-colors text-sm truncate";
                link.dataset.opened = 'false';
                
                // Добавляем обработчик клика для отслеживания
                link.addEventListener('click', () => {
                    if (link.dataset.opened === 'false') {
                        link.dataset.opened = 'true';
                        link.classList.remove('text-teal-600', 'dark:text-teal-400', 'hover:text-teal-700', 'dark:hover:text-teal-300');
                        link.classList.add('text-green-600', 'dark:text-green-400', 'hover:text-green-700', 'dark:hover:text-green-300');
                        
                        // Обновляем прогресс для соответствующей секции
                        updateManualProgress(sectionId);
                    }
                });
                
                return link;
            }

            // Функция для создания элемента кнопки копирования
            function createCopyButton(linkElement) {
                const copyBtn = document.createElement('button');
                copyBtn.className = "text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-400 transition-colors ml-4 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-400 rounded-md";
                copyBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
                        <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" />
                    </svg>
                `;
                copyBtn.title = "Скопировать ссылку";
                copyBtn.addEventListener('click', (event) => {
                    event.preventDefault(); 
                    const linkToCopy = linkElement.href;
                    const tempInput = document.createElement('textarea');
                    tempInput.value = linkToCopy;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    
                    const originalSVG = copyBtn.innerHTML;
                    copyBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 dark:text-green-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                    `;

                    setTimeout(() => {
                        copyBtn.innerHTML = originalSVG;
                    }, 2000);
                });
                return copyBtn;
            }

            // Функция для создания элемента-контейнера ссылки
            function createLinkContainer(link, copyBtn) {
                const linkContainer = document.createElement('div');
                linkContainer.className = "flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors duration-500";
                linkContainer.appendChild(link);
                linkContainer.appendChild(copyBtn);
                return linkContainer;
            }

            // Функция для обновления прогресса ручного открытия
            function updateManualProgress(sectionId) {
                let progressContainer, countElement, barElement;
                
                switch(sectionId) {
                    case 'invoice':
                        progressContainer = invoiceManualProgress;
                        countElement = invoiceManualCount;
                        barElement = invoiceManualProgressBar;
                        break;
                    case 'user':
                        progressContainer = userManualProgress;
                        countElement = userManualCount;
                        barElement = userManualProgressBar;
                        break;
                    case 'crypto':
                        progressContainer = cryptoManualProgress;
                        countElement = cryptoManualCount;
                        barElement = cryptoManualProgressBar;
                        break;
                    case 'pairs':
                        progressContainer = pairsManualProgress;
                        countElement = pairsManualCount;
                        barElement = pairsManualProgressBar;
                        break;
                    default:
                        return;
                }
                
                if (!progressContainer || !countElement || !barElement) return;
                
                const linksOutput = document.querySelector(`#${sectionId === 'invoice' ? 'links' : sectionId === 'user' ? 'user-links' : sectionId === 'crypto' ? 'crypto-links' : 'pairs-links'}-output`);
                const allLinks = linksOutput.querySelectorAll('a');
                const openedLinks = linksOutput.querySelectorAll('a[data-opened="true"]');
                
                const total = allLinks.length;
                const opened = openedLinks.length;
                const progress = total > 0 ? Math.round((opened / total) * 100) : 0;
                
                countElement.textContent = `${opened} из ${total}`;
                barElement.style.width = `${progress}%`;
                
                if (total > 0) {
                    progressContainer.classList.remove('hidden');
                }
            }

            // Логика генератора инвойсов
            const invoiceBaseUrl = "https://lixog.com/ru/admin/app/asyncpayment/list?filter%5B_page%5D=1&filter%5B_per_page%5D=250&filter%5B_sort_by%5D=createdAt&filter%5B_sort_order%5D=DESC&filter%5Buuid%5D%5Btype%5D=3&filter%5Buuid%5D%5Bvalue%5D=";

            generateBtn.addEventListener('click', () => {
                const input = invoiceInput.value;
                const validation = validateInvoiceInput(input);
                
                hideError('invoice-error');
                
                if (!validation.isValid) {
                    showError('invoice-error', validation.errors);
                    return;
                }

                const invoices = input
                    .split('\n')
                    .map(invoice => invoice.trim())
                    .filter(invoice => invoice.length > 0);

                linksOutput.innerHTML = '';
                openAllBtn.classList.add('hidden'); 
                if (invoiceProgress && invoiceProgressBar && invoiceProgressText) {
                    invoiceProgress.classList.add('hidden');
                    invoiceProgressBar.style.width = '0%';
                    invoiceProgressText.textContent = 'Открыто 0 из 0';
                }
                if (invoiceManualProgress && invoiceManualCount && invoiceManualProgressBar) {
                    invoiceManualProgress.classList.add('hidden');
                    invoiceManualCount.textContent = '0 из 0';
                    invoiceManualProgressBar.style.width = '0%';
                }
                if (invoiceCount) {
                    invoiceCount.textContent = 'Ссылок: 0';
                    invoiceCount.classList.add('hidden');
                }

                invoices.forEach(invoice => {
                    const fullUrl = `${invoiceBaseUrl}${encodeURIComponent(invoice)}`;
                    const link = createLinkElement(`Инвойс: ${invoice}`, fullUrl, 'invoice');
                    const copyBtn = createCopyButton(link);
                    linksOutput.appendChild(createLinkContainer(link, copyBtn));
                });

                if (invoices.length > 0) {
                    openAllBtn.classList.remove('hidden');
                    if (invoiceCount) {
                        invoiceCount.textContent = `Ссылок: ${invoices.length}`;
                        invoiceCount.classList.remove('hidden');
                    }
                }
            });

            openAllBtn.addEventListener('click', () => {
                const links = linksOutput.querySelectorAll('a');
                openLinksThrottled(links, 8, {
                    container: invoiceProgress,
                    bar: invoiceProgressBar,
                    text: invoiceProgressText
                });
            });

            // Логика генератора пользователей
            const userBaseUrl = "https://lixog.com/ru/admin/app/user/";

            userGenerateBtn.addEventListener('click', () => {
                const userIds = userInput.value
                    .split('\n')
                    .map(id => id.trim())
                    .filter(id => id.length > 0);

                userLinksOutput.innerHTML = '';
                userOpenAllBtn.classList.add('hidden'); 
                if (userProgress && userProgressBar && userProgressText) {
                    userProgress.classList.add('hidden');
                    userProgressBar.style.width = '0%';
                    userProgressText.textContent = 'Открыто 0 из 0';
                }
                if (userManualProgress && userManualCount && userManualProgressBar) {
                    userManualProgress.classList.add('hidden');
                    userManualCount.textContent = '0 из 0';
                    userManualProgressBar.style.width = '0%';
                }
                if (userCount) {
                    userCount.textContent = 'Ссылок: 0';
                    userCount.classList.add('hidden');
                }

                if (userIds.length === 0) {
                    const noLinks = document.createElement('p');
                    noLinks.className = "text-center text-slate-500 italic mt-4 transition-colors duration-500";
                    noLinks.textContent = "Пожалуйста, введите ID пользователей.";
                    userLinksOutput.appendChild(noLinks);
                    return;
                }

                userIds.forEach(userId => {
                    const fullUrl = `${userBaseUrl}${encodeURIComponent(userId)}/show`;
                    const link = createLinkElement(`Пользователь: ${userId}`, fullUrl, 'user');
                    const copyBtn = createCopyButton(link);
                    userLinksOutput.appendChild(createLinkContainer(link, copyBtn));
                });

                if (userIds.length > 0) {
                    userOpenAllBtn.classList.remove('hidden');
                    if (userCount) {
                        userCount.textContent = `Ссылок: ${userIds.length}`;
                        userCount.classList.remove('hidden');
                    }
                }
            });

            userOpenAllBtn.addEventListener('click', () => {
                const links = userLinksOutput.querySelectorAll('a');
                openLinksThrottled(links, 8, {
                    container: userProgress,
                    bar: userProgressBar,
                    text: userProgressText
                });
            });

            // Логика генератора криптокошельков
            const cryptoExplorers = {
                // UTXO
                btc: { name: 'Bitcoin', url: 'https://www.blockchain.com/btc/address/' },
                ltc: { name: 'Litecoin', url: 'https://blockchair.com/litecoin/address/' },
                doge: { name: 'Dogecoin', url: 'https://blockchair.com/dogecoin/address/' },
                dash: { name: 'Dash', url: 'https://blockchair.com/dash/address/' },
                bch: { name: 'Bitcoin Cash', url: 'https://blockchair.com/bitcoin-cash/address/' },

                // EVM-сети (одинаковый формат 0x...)
                eth: { name: 'Ethereum', url: 'https://etherscan.io/address/' },
                bsc: { name: 'BNB Smart Chain', url: 'https://bscscan.com/address/' },
                polygon: { name: 'Polygon', url: 'https://polygonscan.com/address/' },
                arbitrum: { name: 'Arbitrum', url: 'https://arbiscan.io/address/' },
                optimism: { name: 'Optimism', url: 'https://optimistic.etherscan.io/address/' },
                avalanche: { name: 'Avalanche C-Chain', url: 'https://snowtrace.io/address/' },
                fantom: { name: 'Fantom', url: 'https://ftmscan.com/address/' },
                base: { name: 'Base', url: 'https://basescan.org/address/' },
                zksync: { name: 'zkSync Era', url: 'https://explorer.zksync.io/address/' },

                // Account-based разные форматы
                tron: { name: 'TRON (TRC20)', url: 'https://tronscan.org/#/address/' },
                ton: { name: 'TON', url: 'https://tonviewer.com/' },
                xrp: { name: 'Ripple (XRP)', url: 'https://xrpscan.com/account/' },
                xlm: { name: 'Stellar (XLM)', url: 'https://stellarchain.io/address/' },
                ada: { name: 'Cardano (ADA)', url: 'https://cardanoscan.io/address/' },
                sol: { name: 'Solana', url: 'https://explorer.solana.com/address/' },
                near: { name: 'NEAR', url: 'https://explorer.near.org/accounts/' },
                algo: { name: 'Algorand (ALGO)', url: 'https://algoexplorer.io/address/' },
                tez: { name: 'Tezos', url: 'https://tzkt.io/' },
                bnbb: { name: 'BNB Beacon Chain', url: 'https://explorer.bnbchain.org/address/' }
            };
            
            // Определяет сеть по формату адреса
            function getWalletNetwork(address) {
                const normalizedAddress = address.trim();
                const networks = [];

                // EVM 0x-адреса → несколько сетей
                if (/^0x[a-fA-F0-9]{40}$/.test(normalizedAddress)) {
                    networks.push('eth','bsc','polygon','arbitrum','optimism','avalanche','fantom','base','zksync');
                }

                // TRON (Base58Check), обычно T + 33 символа
                if (/^T[a-zA-Z0-9]{33}$/.test(normalizedAddress)) {
                    networks.push('tron');
                }

                // TON (base64url, длина 48-49, начинается с U/Q/E)
                if (/^[UQE][a-zA-Z0-9_-]{47,48}$/.test(normalizedAddress)) {
                    networks.push('ton');
                }

                // BTC (legacy + segwit/bech32)
                if (/^1[a-km-zA-HJ-NP-Z1-9]{25,34}$/.test(normalizedAddress)
                 || /^3[a-km-zA-HJ-NP-Z1-9]{25,34}$/.test(normalizedAddress)
                 || /^bc1[ac-hj-np-z02-9]{25,89}$/.test(normalizedAddress)) {
                    networks.push('btc');
                }

                // BCH (cashaddr): bitcoincash:... или q/p префикс длиной ~42
                if (/^(bitcoincash:)?[qp][a-z0-9]{41,50}$/i.test(normalizedAddress)) {
                    networks.push('bch');
                }

                // Litecoin (legacy + bech32: ltc1)
                if (/^L[1-9A-HJ-NP-Za-km-z]{26,33}$/.test(normalizedAddress)
                 || /^M[1-9A-HJ-NP-Za-km-z]{26,33}$/.test(normalizedAddress)
                 || /^ltc1[ac-hj-np-z02-9]{25,89}$/.test(normalizedAddress)) {
                    networks.push('ltc');
                }

                // Dogecoin
                if (/^D[1-9A-HJ-NP-Za-km-z]{25,34}$/.test(normalizedAddress)) {
                    networks.push('doge');
                }

                // Dash
                if (/^X[1-9A-HJ-NP-Za-km-z]{25,34}$/.test(normalizedAddress)) {
                    networks.push('dash');
                }

                // XRP (Ripple) r + base58 25-35
                if (/^r[1-9A-HJ-NP-Za-km-z]{24,34}$/.test(normalizedAddress)) {
                    networks.push('xrp');
                }

                // Stellar (G + 55 base32)
                if (/^G[A-Z2-7]{55}$/.test(normalizedAddress)) {
                    networks.push('xlm');
                }

                // Cardano (bech32 addr1...)
                if (/^addr1[0-9a-z]{20,}$/i.test(normalizedAddress)) {
                    networks.push('ada');
                }

                // Solana (base58 32-44) — эвристика
                if (/^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(normalizedAddress)) {
                    networks.push('sol');
                }

                // NEAR (аккаунты заканчиваются на .near)
                if (/\.near$/i.test(normalizedAddress)) {
                    networks.push('near');
                }

                // Algorand (58 символов base32 A-Z2-7)
                if (/^[A-Z2-7]{58}$/i.test(normalizedAddress)) {
                    networks.push('algo');
                }

                // Tezos (tz1/tz2/tz3)
                if (/^tz[1-3][1-9A-HJ-NP-Za-km-z]{33}$/.test(normalizedAddress)) {
                    networks.push('tez');
                }

                // BNB Beacon Chain (bnb1...)
                if (/^bnb1[0-9a-z]{10,}$/i.test(normalizedAddress)) {
                    networks.push('bnbb');
                }
                
                return networks.length > 0 ? networks : null;
            }

            cryptoGenerateBtn.addEventListener('click', () => {
                const addresses = cryptoInput.value
                    .split('\n')
                    .map(address => address.trim())
                    .filter(address => address.length > 0);

                cryptoLinksOutput.innerHTML = '';
                cryptoOpenAllBtn.classList.add('hidden'); 
                if (cryptoProgress && cryptoProgressBar && cryptoProgressText) {
                    cryptoProgress.classList.add('hidden');
                    cryptoProgressBar.style.width = '0%';
                    cryptoProgressText.textContent = 'Открыто 0 из 0';
                }
                if (cryptoManualProgress && cryptoManualCount && cryptoManualProgressBar) {
                    cryptoManualProgress.classList.add('hidden');
                    cryptoManualCount.textContent = '0 из 0';
                    cryptoManualProgressBar.style.width = '0%';
                }
                if (cryptoCount) {
                    cryptoCount.textContent = 'Ссылок: 0';
                    cryptoCount.classList.add('hidden');
                }
                if (cryptoFilters) {
                    cryptoFilters.classList.add('hidden');
                }

                if (addresses.length === 0) {
                    const noLinks = document.createElement('p');
                    noLinks.className = "text-center text-slate-500 italic mt-4 transition-colors duration-500";
                    noLinks.textContent = "Пожалуйста, введите адреса кошельков.";
                    cryptoLinksOutput.appendChild(noLinks);
                    return;
                }

                // Group networks by type
                const networkGroups = {
                    utxo: ['btc', 'ltc', 'doge', 'dash', 'bch'],
                    evm: ['eth', 'bsc', 'polygon', 'arbitrum', 'optimism', 'avalanche', 'fantom', 'base', 'zksync'],
                    account: ['tron', 'ton', 'xrp', 'xlm', 'ada', 'sol', 'near', 'algo', 'tez', 'bnbb']
                };

                let totalLinks = 0;
                const groupedLinks = { utxo: [], evm: [], account: [] };

                addresses.forEach(address => {
                    const networks = getWalletNetwork(address);
                    
                    if (networks) {
                        networks.forEach(network => {
                            const explorer = cryptoExplorers[network];
                            const fullUrl = `${explorer.url}${encodeURIComponent(address)}`;
                            const link = createLinkElement(`${explorer.name}: ${address}`, fullUrl, 'crypto');
                            const copyBtn = createCopyButton(link);
                            const container = createLinkContainer(link, copyBtn);
                            
                            // Determine network type
                            let networkType = 'account';
                            if (networkGroups.utxo.includes(network)) networkType = 'utxo';
                            else if (networkGroups.evm.includes(network)) networkType = 'evm';
                            
                            container.dataset.networkType = networkType;
                            groupedLinks[networkType].push(container);
                            totalLinks++;
                        });
                    } else {
                        const unknownLink = document.createElement('p');
                        unknownLink.className = "text-red-500 dark:text-red-400 text-sm italic mt-2";
                        unknownLink.textContent = `Адрес "${address}" не распознан.`;
                        cryptoLinksOutput.appendChild(unknownLink);
                    }
                });

                // Create grouped sections
                Object.entries(groupedLinks).forEach(([type, links]) => {
                    if (links.length > 0) {
                        const section = document.createElement('div');
                        section.className = 'mb-4';
                        section.dataset.networkType = type;
                        
                        const header = document.createElement('div');
                        header.className = 'flex items-center justify-between mb-2 p-2 bg-slate-100 dark:bg-slate-800 rounded-lg cursor-pointer';
                        header.innerHTML = `
                            <h3 class="font-medium text-slate-700 dark:text-slate-300">${type.toUpperCase()} (${links.length})</h3>
                            <svg class="w-4 h-4 text-slate-500 transform transition-transform" data-arrow>
                                <path fill="currentColor" d="M7 10l5 5 5-5z"/>
                            </svg>
                        `;
                        
                        const content = document.createElement('div');
                        content.className = 'space-y-2';
                        content.style.display = 'block';
                        
                        links.forEach(link => content.appendChild(link));
                        
                        section.appendChild(header);
                        section.appendChild(content);
                        cryptoLinksOutput.appendChild(section);
                        
                        // Add collapse functionality
                        header.addEventListener('click', () => {
                            const isCollapsed = content.style.display === 'none';
                            content.style.display = isCollapsed ? 'block' : 'none';
                            const arrow = header.querySelector('[data-arrow]');
                            arrow.style.transform = isCollapsed ? 'rotate(0deg)' : 'rotate(180deg)';
                        });
                    }
                });

                if (cryptoLinksOutput.querySelectorAll('a').length > 0) {
                    cryptoOpenAllBtn.classList.remove('hidden');
                    if (cryptoCount) {
                        cryptoCount.textContent = `Ссылок: ${totalLinks}`;
                        cryptoCount.classList.remove('hidden');
                    }
                    if (cryptoFilters) {
                        cryptoFilters.classList.remove('hidden');
                    }
                }
            });

            cryptoOpenAllBtn.addEventListener('click', () => {
                const links = cryptoLinksOutput.querySelectorAll('a');
                openLinksThrottled(links, 8, {
                    container: cryptoProgress,
                    bar: cryptoProgressBar,
                    text: cryptoProgressText
                });
            });

            // Crypto filter functionality
            function setCryptoFilter(activeFilter) {
                const sections = cryptoLinksOutput.querySelectorAll('[data-network-type]');
                const buttons = [cryptoFilterAll, cryptoFilterUtxo, cryptoFilterEvm, cryptoFilterAccount];
                
                // Update button styles
                buttons.forEach(btn => {
                    btn.classList.remove('bg-teal-500', 'text-white');
                    btn.classList.add('bg-slate-200', 'dark:bg-slate-700', 'text-slate-700', 'dark:text-slate-300');
                });
                
                const activeButton = activeFilter === 'all' ? cryptoFilterAll :
                                   activeFilter === 'utxo' ? cryptoFilterUtxo :
                                   activeFilter === 'evm' ? cryptoFilterEvm : cryptoFilterAccount;
                
                activeButton.classList.remove('bg-slate-200', 'dark:bg-slate-700', 'text-slate-700', 'dark:text-slate-300');
                activeButton.classList.add('bg-teal-500', 'text-white');
                
                // Show/hide sections
                sections.forEach(section => {
                    if (activeFilter === 'all' || section.dataset.networkType === activeFilter) {
                        section.style.display = 'block';
                    } else {
                        section.style.display = 'none';
                    }
                });
            }

            cryptoFilterAll.addEventListener('click', () => setCryptoFilter('all'));
            cryptoFilterUtxo.addEventListener('click', () => setCryptoFilter('utxo'));
            cryptoFilterEvm.addEventListener('click', () => setCryptoFilter('evm'));
            cryptoFilterAccount.addEventListener('click', () => setCryptoFilter('account'));

            // Validation functions
            function validateInvoiceInput(input) {
                const lines = input.split('\n').map(line => line.trim()).filter(Boolean);
                const errors = [];
                
                if (lines.length === 0) {
                    errors.push('Введите хотя бы один номер инвойса');
                }
                
                lines.forEach((line, index) => {
                    if (!/^\d+$/.test(line)) {
                        errors.push(`Строка ${index + 1}: номер инвойса должен содержать только цифры`);
                    }
                    if (line.length < 10) {
                        errors.push(`Строка ${index + 1}: номер инвойса слишком короткий`);
                    }
                });
                
                return { isValid: errors.length === 0, errors };
            }

            function validateUserInput(input) {
                const lines = input.split('\n').map(line => line.trim()).filter(Boolean);
                const errors = [];
                
                if (lines.length === 0) {
                    errors.push('Введите хотя бы один ID пользователя');
                }
                
                lines.forEach((line, index) => {
                    if (!/^\d+$/.test(line)) {
                        errors.push(`Строка ${index + 1}: ID пользователя должен содержать только цифры`);
                    }
                });
                
                return { isValid: errors.length === 0, errors };
            }

            function validateCryptoInput(input) {
                const lines = input.split('\n').map(line => line.trim()).filter(Boolean);
                const errors = [];
                
                if (lines.length === 0) {
                    errors.push('Введите хотя бы один адрес кошелька');
                }
                
                return { isValid: errors.length === 0, errors };
            }

            function showError(elementId, errors) {
                const errorElement = document.getElementById(elementId);
                if (errorElement) {
                    errorElement.textContent = errors.join(', ');
                    errorElement.classList.remove('hidden');
                }
            }

            function hideError(elementId) {
                const errorElement = document.getElementById(elementId);
                if (errorElement) {
                    errorElement.classList.add('hidden');
                }
            }

            // Универсальная функция троттлинга открытия ссылок с прогрессом
            function openLinksThrottled(linksNodeList, perSecond, ui) {
                const links = Array.from(linksNodeList);
                const total = links.length;
                if (total === 0) return;

                const { container, bar, text } = ui || {};
                if (container && bar && text) {
                    container.classList.remove('hidden');
                    bar.style.width = '0%';
                    text.textContent = `Открыто 0 из ${total}`;
                }

                let opened = 0;
                const batchSize = Math.max(1, perSecond | 0);

                const interval = setInterval(() => {
                    for (let i = 0; i < batchSize && opened < total; i++) {
                        const a = links[opened];
                        try {
                            window.open(a.href, '_blank');
                        } catch (e) {
                            // игнорируем ошибки открытия окна
                        }
                        opened++;
                    }

                    const progress = Math.min(100, Math.round((opened / total) * 100));
                    if (container && bar && text) {
                        bar.style.width = progress + '%';
                        text.textContent = `Открыто ${opened} из ${total}`;
                    }

                    if (opened >= total) {
                        clearInterval(interval);
                    }
                }, 1000);
            }

            // Логика анализа данных пользователей
            let uniqueResults = { asn: new Set(), devices: new Set() };

            userDataAnalyzeBtn.addEventListener('click', () => {
                const inputData = userDataInput.value.trim();
                userDataOutput.innerHTML = '';
                userDataCopyTableBtn.classList.add('hidden');
                userDataCopyAsnBtn.classList.add('hidden');
                userDataCopyDevicesBtn.classList.add('hidden');

                if (!inputData) {
                    const noData = document.createElement('p');
                    noData.className = "text-center text-slate-500 italic mt-4 transition-colors duration-500";
                    noData.textContent = "Пожалуйста, вставьте данные пользователей.";
                    userDataOutput.appendChild(noData);
                    return;
                }

                // Парсим данные
                const lines = inputData.split('\n').filter(line => line.trim());
                if (lines.length < 2) {
                    const invalidData = document.createElement('p');
                    invalidData.className = "text-center text-red-500 italic mt-4 transition-colors duration-500";
                    invalidData.textContent = "Недостаточно данных для анализа.";
                    userDataOutput.appendChild(invalidData);
                    return;
                }

                // Сбрасываем результаты
                uniqueResults = { asn: new Set(), devices: new Set() };

                // Обрабатываем все строки (нет заголовка в вашем формате)
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    // Разделяем по табу
                    const columns = line.split('\t').filter(col => col.trim());
                    
                    if (columns.length >= 6) {
                        // ASN - 2-я колонка (индекс 1) - IP адрес, ASN, страна, город, user agent, регион
                        const asn = columns[1]?.trim();
                        if (asn && !isNaN(asn)) {
                            uniqueResults.asn.add(asn);
                        }

                        // User agent - 5-я колонка (индекс 4)
                        const userAgent = columns[4]?.trim();
                        if (userAgent && userAgent.startsWith('Mozilla/')) {
                            // Сохраняем полный User Agent
                            uniqueResults.devices.add(userAgent);
                        }
                    }
                }

                // Отображаем результаты
                displayResults();
            });


            function displayResults() {
                const asnArray = Array.from(uniqueResults.asn).sort();
                const devicesArray = Array.from(uniqueResults.devices).sort();

                // Создаем контейнер для результатов
                const resultsContainer = document.createElement('div');
                resultsContainer.className = "bg-slate-50 dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700";

                // Заголовок
                const title = document.createElement('h3');
                title.className = "text-lg font-semibold text-slate-700 dark:text-slate-200 mb-4 text-center";
                title.textContent = `Уникальные значения (ASN: ${asnArray.length}, Устройства: ${devicesArray.length})`;
                resultsContainer.appendChild(title);

                // Создаем таблицу
                const table = document.createElement('table');
                table.className = "w-full border-collapse";
                
                // Заголовки таблицы
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                headerRow.className = "border-b border-slate-300 dark:border-slate-600";
                
                const asnHeader = document.createElement('th');
                asnHeader.className = "text-left py-3 px-4 font-semibold text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-700";
                asnHeader.textContent = "ASN";
                
                const deviceHeader = document.createElement('th');
                deviceHeader.className = "text-left py-3 px-4 font-semibold text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-700";
                deviceHeader.textContent = "Устройство";
                
                headerRow.appendChild(asnHeader);
                headerRow.appendChild(deviceHeader);
                thead.appendChild(headerRow);
                table.appendChild(thead);

                // Тело таблицы
                const tbody = document.createElement('tbody');
                
                // Определяем максимальную длину для выравнивания строк
                const maxLength = Math.max(asnArray.length, devicesArray.length);
                
                for (let i = 0; i < maxLength; i++) {
                    const row = document.createElement('tr');
                    row.className = "border-b border-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors";
                    
                    // ASN колонка
                    const asnCell = document.createElement('td');
                    asnCell.className = "py-3 px-4 text-slate-600 dark:text-slate-300 font-mono text-sm";
                    asnCell.textContent = asnArray[i] || '';
                    
                    // Устройство колонка
                    const deviceCell = document.createElement('td');
                    deviceCell.className = "py-3 px-4 text-slate-600 dark:text-slate-300 text-sm";
                    deviceCell.textContent = devicesArray[i] || '';
                    
                    row.appendChild(asnCell);
                    row.appendChild(deviceCell);
                    tbody.appendChild(row);
                }
                
                table.appendChild(tbody);
                resultsContainer.appendChild(table);

                // Показываем кнопку копирования если есть результаты
                if (asnArray.length > 0 || devicesArray.length > 0) {
                    userDataCopyTableBtn.classList.remove('hidden');
                    userDataCopyAsnBtn.classList.remove('hidden');
                    userDataCopyDevicesBtn.classList.remove('hidden');
                }

                userDataOutput.appendChild(resultsContainer);
            }

            // Копировать таблицу
            userDataCopyTableBtn.addEventListener('click', () => {
                const { asnArray, devicesArray } = getResultsFromTable();
                
                // Формируем строку для копирования в табличном формате
                let copyText = 'ASN\tУстройство\n';
                const maxLength = Math.max(asnArray.length, devicesArray.length);
                for (let i = 0; i < maxLength; i++) {
                    const asn = asnArray[i] || '';
                    const device = devicesArray[i] || '';
                    copyText += `${asn}\t${device}\n`;
                }

                copyWithFallback(copyText, userDataCopyTableBtn, 'bg-slate-300 dark:bg-slate-700');
            });

            // Копировать только ASN (столбик)
            userDataCopyAsnBtn.addEventListener('click', () => {
                const { asnArray } = getResultsFromTable();
                const text = asnArray.join('\n');
                copyWithFallback(text, userDataCopyAsnBtn, 'bg-slate-200 dark:bg-slate-800');
            });

            // Копировать только устройства (столбик)
            userDataCopyDevicesBtn.addEventListener('click', () => {
                const { devicesArray } = getResultsFromTable();
                const text = devicesArray.join('\n');
                copyWithFallback(text, userDataCopyDevicesBtn, 'bg-slate-200 dark:bg-slate-800');
            });

            function getResultsFromTable() {
                const asnArray = [];
                const devicesArray = [];
                const table = userDataOutput.querySelector('table');
                if (!table) return { asnArray, devicesArray };
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const asn = (cells[0]?.textContent || '').trim();
                    const device = (cells[1]?.textContent || '').trim();
                    if (asn) asnArray.push(asn);
                    if (device) devicesArray.push(device);
                });
                return { asnArray, devicesArray };
            }

            function copyWithFallback(text, buttonEl, defaultBgClasses) {
                const onSuccess = () => {
                    // Анимация на кнопке
                    const originalText = buttonEl.textContent;
                    buttonEl.textContent = 'Скопировано!';
                    buttonEl.className = buttonEl.className.replace(defaultBgClasses, 'bg-green-500 dark:bg-green-600');
                    setTimeout(() => {
                        buttonEl.textContent = originalText;
                        buttonEl.className = buttonEl.className.replace('bg-green-500 dark:bg-green-600', defaultBgClasses);
                    }, 1200);
                    // Тост
                    showToast();
                 };

                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(onSuccess).catch(() => {
                        legacyCopy(text, onSuccess);
                    });
                } else {
                    legacyCopy(text, onSuccess);
                }
            }

            function legacyCopy(text, onSuccess) {
                try {
                    const temp = document.createElement('textarea');
                    temp.value = text;
                    temp.style.position = 'fixed';
                    temp.style.opacity = '0';
                    document.body.appendChild(temp);
                    temp.focus();
                    temp.select();
                    const ok = document.execCommand('copy');
                    document.body.removeChild(temp);
                    if (ok) onSuccess();
                    else throw new Error('execCommand failed');
                } catch (e) {
                    console.error('Ошибка копирования:', e);
                    alert('Не удалось скопировать данные. Выделите текст вручную.');
                }
            }

            function showToast() {
                if (!copyToast) return;
                copyToast.classList.remove('opacity-0', 'translate-y-4');
                copyToast.classList.add('opacity-100', 'translate-y-0');
                setTimeout(() => {
                    copyToast.classList.remove('opacity-100', 'translate-y-0');
                    copyToast.classList.add('opacity-0', 'translate-y-4');
                }, 1200);
            }

            // List virtualization for 20+ links
            function implementVirtualization(container, items, itemsPerPage = 20) {
                if (items.length <= itemsPerPage) return;
                
                const totalPages = Math.ceil(items.length / itemsPerPage);
                let currentPage = 1;
                
                const pagination = document.createElement('div');
                pagination.className = 'flex items-center justify-center gap-2 mt-4';
                pagination.innerHTML = `
                    <button class="px-3 py-1 text-sm bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded hover:bg-slate-300 dark:hover:bg-slate-600" data-action="prev">←</button>
                    <span class="text-sm text-slate-600 dark:text-slate-400" data-page-info>1 из ${totalPages}</span>
                    <button class="px-3 py-1 text-sm bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded hover:bg-slate-300 dark:hover:bg-slate-600" data-action="next">→</button>
                `;
                
                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'space-y-2';
                container.appendChild(itemsContainer);
                container.appendChild(pagination);
                
                function renderPage(page) {
                    const start = (page - 1) * itemsPerPage;
                    const end = start + itemsPerPage;
                    const pageItems = items.slice(start, end);
                    
                    itemsContainer.innerHTML = '';
                    pageItems.forEach(item => itemsContainer.appendChild(item));
                    
                    const pageInfo = pagination.querySelector('[data-page-info]');
                    pageInfo.textContent = `${page} из ${totalPages}`;
                    
                    const prevBtn = pagination.querySelector('[data-action="prev"]');
                    const nextBtn = pagination.querySelector('[data-action="next"]');
                    
                    prevBtn.disabled = page === 1;
                    nextBtn.disabled = page === totalPages;
                    
                    prevBtn.classList.toggle('opacity-50', page === 1);
                    nextBtn.classList.toggle('opacity-50', page === totalPages);
                }
                
                pagination.addEventListener('click', (e) => {
                    const action = e.target.dataset.action;
                    if (action === 'prev' && currentPage > 1) {
                        currentPage--;
                        renderPage(currentPage);
                    } else if (action === 'next' && currentPage < totalPages) {
                        currentPage++;
                        renderPage(currentPage);
                    }
                });
                
                renderPage(1);
            }

            // Apply virtualization to specific link outputs (exclude pairs due to grouping)
            function applyVirtualizationToOutputs() {
                const outputs = [
                    { container: linksOutput, selector: 'a' },
                    { container: userLinksOutput, selector: 'a' }
                    // Exclude cryptoLinksOutput and pairsLinksOutput due to grouping/filtering
                ];
                
                outputs.forEach(({ container, selector }) => {
                    const observer = new MutationObserver(() => {
                        const links = container.querySelectorAll(selector);
                        if (links.length > 20) {
                            const items = Array.from(links).map(link => link.parentElement);
                            implementVirtualization(container, items);
                        }
                    });
                    
                    observer.observe(container, { childList: true, subtree: true });
                });
            }

            // Initialize virtualization
            applyVirtualizationToOutputs();
        });
    </script>
</body>
</html>
